## ã¯ã˜ã‚ã«

Apollo Server ã‚’ä½¿ã£ã¦ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰é–‹ç™ºã‚’ã—ãŸã„æ™‚ã€ã•ã£ã¨ä½œã‚Œã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Œã°è‰¯ã„ã¨æ€ã„ã€ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚GraphQL ã®å‹ã®æ©æµã‚’æœ€å¤§é™å—ã‘ã‚‹ãŸã‚ã€GraphQL Codegen ã‚‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å«ã¾ã‚Œã¾ã™

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ä¸‹å›³ã®ã‚ˆã†ã« 2 ã¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ä½¿ã„ã¾ã™ã€‚ã¾ãšã¯ 1 ã¤ç›®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¦ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰ GraphQL Codegen ã®å®Ÿè¡Œã¾ã§ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚

![ã‚¢ãƒ¼ãƒˆãƒœãƒ¼ãƒ‰ 2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/7e11f3d9-5947-276f-2860-52e8a96f154e.png)

:large_orange_diamond: Action: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ä¸€æ°—ã«å…¨éƒ¨ã‚³ãƒ”ãƒ¼ & ãƒšãƒ¼ã‚¹ãƒˆã—ã¦å®Ÿè¡Œã—ã¦æ§‹ã„ã¾ã›ã‚“ã€‚

```terminal
mkdir server
cd server

# node.js setup
npm init -y
echo "node_modules" > .gitignore

# install and initialize typescript
npm install --save-dev typescript
npx tsc --init

# ts-node-dev: watch and restart a TypeScript server
npm install --save-dev ts-node-dev
npm pkg set scripts.start="ts-node-dev --watch src/* --respawn src/index.ts"

# apollo server
npm install apollo-server graphql

# install and setup graphql-codegen
npm install --save-dev @graphql-codegen/cli
# ã“ã“ã§ npx graphql-code-generator init ã‚’è¡Œã£ã¦ã‚‚ã‚ˆã„ãŒã€ãã†ã™ã‚‹ã¨å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã£ã¦æ‰‹å…¥åŠ›ãŒå¢—ãˆã‚‹ã®ã¨ã€
# çµå±€ã¯ npx graphql-code-generator init ã§ç”Ÿæˆã•ã‚ŒãŸconfig.ymlã‚’ä¸Šæ›¸ãæ›´æ–°ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ä»¥ä¸‹ã¯npm installã®ã¿è¡Œã£ã¦ config.ymlã¯å¾Œã»ã©ä½œæˆ
npm install --save-dev  @graphql-codegen/typescript @graphql-codegen/typescript-resolvers
npm pkg set scripts.start="graphql-codegen --config codegen.yml --watch ./schema.gql" # update generate script

# copy files
mkdir src
mkdir data
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/codegen.yml > codegen.yml
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/schema.gql > schema.gql
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/src/index.ts > src/index.ts
curl https://raw.githubusercontent.com/richardimaoka/tutorial-apollo-server-setup/main/server/data/Query.json > data/Query.json
```

:large_orange_diamond: Action: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```terminal
npm run generate
```

:white_check_mark: Result: ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã° OK ã§ã™

```terminal
âœ” Parse Configuration
âœ” Generate outputs
  â„¹ Watching for changes...
```

ã“ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¯ãã®ã¾ã¾ GraphQL Codegen ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ°ã‚‰ã›ç¶šã‘ã¦ãã ã•ã„ã€‚

:large_orange_diamond: Action: æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¦ãã ã•ã„ã€‚

![ã‚¢ãƒ¼ãƒˆãƒœãƒ¼ãƒ‰ 3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/434595ea-e610-5830-44f2-5a9e58e4c9fe.png)

:large_orange_diamond: Action: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

```terminal
cd server
npm start
```

:white_check_mark: Result: ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã° OK ã§ã™ã€‚ã“ã‚Œã§ Apollo Server ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã—ãŸã€‚

```terminal
[INFO] 14:30:40 ts-node-dev ver. 1.1.8 (using ts-node ver. 9.1.1, typescript ver. 4.5.4)
ğŸš€  Server ready at http://localhost:4000/
```

<details><summary>(Optional) Apollo Server ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹</summary><div>

:large_orange_diamond: Action: ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:4000/ ã‚’é–‹ã„ã¦ãã ã•ã„

:white_check_mark: Result: ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/58dd6755-b37b-9f64-3047-a1a2e8e7b0b9.png)

ã“ã‚Œã¯[The Apollo Studio Explorer](https://www.apollographql.com/docs/studio/explorer/explorer/)ã¨å‘¼ã°ã‚Œã‚‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‚’å©ããŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

> The Apollo Studio Explorer is a powerful web IDE for creating, running, and managing GraphQL operations:

:large_orange_diamond: Action: ä¸Šè¨˜ã®ç”»é¢ã«ã‚ã‚‹ã€Query your server ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„

:white_check_mark: Result: ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã«é·ç§»ã—ã¾ã™ã€‚

![2022-01-25_00h35_02.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/0d0ce96f-db92-760c-801e-3cff25131d5a.png)

:large_orange_diamond: Action: "Operation"ã®éƒ¨åˆ†ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å…¥åŠ›ã—ã€ä¸­æ‹¬å¼§`{}`ã®ä¸­ã§ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚è‡ªå‹•è£œå®ŒãŒåŠ¹ã„ã¦å€™è£œãŒç¾ã‚Œã¾ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/f3e998b8-685e-4b6b-a95f-010f4905daf5.png)

:large_orange_diamond: Action: å€™è£œã‹ã‚‰"hello"ã‚’é¸ã‚“ã§"Run"ã‚’æŠ¼ã—ã¦ãã ã•ã„

![2022-01-25_00h36_07.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/e1a54767-e5aa-6adf-53e9-1094323759fd.png)

:white_check_mark: Result: "Response"ã®éƒ¨åˆ†ã«"hello world"ã¨ã„ã†ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![2022-01-25_00h36_15.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/07b28d64-adec-5674-d2c3-6b0d1a2d6572.png)

---

</div></details>

<details><summary>(Optional) GraphQL ã‚µãƒ¼ãƒãƒ¼é–‹ç™ºã®åŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«</summary><div>

ã“ã“ã¾ã§ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¦ã€ã‚ã¨ã¯æ€ã†ã‚ˆã†ã« Apollo Server ã‚’ä½¿ã£ã¦ GraphQL ã‚µãƒ¼ãƒãƒ¼ã®é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‘ã°ã„ã„ã®ã§ã™ãŒã€ã¾ã ãã®æ‰‹é †ã«é¦´æŸ“ã¿ãŒãªã„äººã®ãŸã‚ã«ã€åŸºæœ¬çš„ãªé–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã‚’ç´¹ä»‹ã—ã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯ GraphQL ã‚¹ã‚­ãƒ¼ãƒã®å¤‰æ›´ã‚’è¡Œã„ã¾ã™ã€‚

:large_orange_diamond: Action: ä»¥ä¸‹ã®å†…å®¹ã‚’`schema.gql`ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

```graphql:server/schema.gql
type Query {
  hello: String
  search(department: String): [Employee]
}

type Employee {
  name: String
  jobTitle: String
  department: String
}
```

:white_check_mark: Result: `server/src/generated/graphql.ts` ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹ã¨ã¨ã‚‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![2022-08-01_00h19_04.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/75738/0f5dd9de-0680-6e15-e4db-7eafb7104bd4.png)

ãã“ã§ã€`index.ts`ã®æ›´æ–°ã‚’è¡Œã„ã¾ã™ã€‚

:large_orange_diamond: Action: ä»¥ä¸‹ã®å†…å®¹ã‚’`index.ts`ã® `const resolvers: ....`ã®éƒ¨åˆ†ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

```ts:server/src/index.ts
const resolvers: Resolvers<LoadingDataContext> = {
  Query: {
    hello: async (parent, args, context, info) => {
      return context.Query.hello;
    },
    search: async (parent, args, context, info) => {
      return context.Query.search;
    },
  },
  Employee: {
    name: async (parent, args, content, info) => {
      return parent.name;
    },
    jobTitle: async (parent, args, content, info) => {
      return parent.jobTitle;
    },
    department: async (parent, args, content, info) => {
      return parent.department;
    },
  },
};
```

æœ€å¾Œã«ã€ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚’è¡Œã„ã¾ã™ã€‚

:large_orange_diamond: Action: ä»¥ä¸‹ã®å†…å®¹ã‚’`Query.json`ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

```json:server/data/Query.json
{
  "hello": "Hello World",
  "search": [
    {
      "name": "ã‚´ãƒ¼ãƒ‰ãƒ³å³¶æ´¥",
      "jobTitle": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
      "department": "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨é–€"
    },
    {
      "name": "ã‚­ãƒ£ã‚µãƒªãƒ³æ¢…ç”°",
      "jobTitle": "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
      "department": "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨é–€"
    },
    {
      "name": "æ˜¥å­ã‚µãƒ³ãƒ€ãƒ¼ãƒœãƒ«ãƒˆ",
      "jobTitle": "ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
      "department": "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°éƒ¨é–€"
    }
  ]
}
```

ã“ã‚Œã§æ›´æ–°ã—ãŸ GraphQL ã‚¹ã‚­ãƒ¼ãƒã«åˆã‚ã›ãŸã‚µãƒ¼ãƒãƒ¼å´ã®æ›´æ–°ãŒã§ãã¾ã—ãŸã€‚ã“ã®æµã‚Œã‚’ç¹°ã‚Šè¿”ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’é–‹ç™ºã—ã¦ã„ãã®ãŒã€ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’åˆ©ç”¨ã—ãŸé–‹ç™ºã®åŸºæœ¬ã«ãªã‚Šã¾ã™ã€‚

</div></details>
