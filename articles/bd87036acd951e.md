---
title: "ã‚³ãƒ”ãƒšã§å­¦ã¶ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: Dockerfileã®CMDã¨ENTRYPOINTã®é•ã„"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker"]
published: false
---

Dockerfile ã® CMD ã¨ ENTRYPOINT ã«ã¤ã„ã¦ã€æ‰‹ã‚’å‹•ã‹ã—ã¦å‹•ä½œç¢ºèªã§ãã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚‚ã‚ã‚‹ã¨ç†è§£ãŒã—ã‚„ã™ã„ã‹ã¨æ€ã„ã€ã‚³ãƒ”ãƒšã ã‘ã§ç°¡å˜ã«å­¦ã¹ã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

:::details ãã‚Œãã‚Œã®é•ã„ã«ã¤ã„ã¦ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ã€æ•°å¤šãã®ãƒ–ãƒ­ã‚°è¨˜äº‹ãªã©ã§ã‚‚è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚

- [Dockerfile reference](https://docs.docker.com/engine/reference/builder/#cmd)
- [Best practices for writing Dockerfiles](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#cmd)
- [ENTRYPOINT ã¯ã€Œå¿…ãšå®Ÿè¡Œã€ã€CMD ã¯ã€Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ï¼‰å¼•æ•°ã€](https://pocketstudio.net/2020/01/31/cmd-and-entrypoint/) - POCKETSTUDIO.NET (å‰ä½› é›…äººã•ã‚“ã®ãƒ–ãƒ­ã‚°)

ã“ã“ã«æŒ™ã’ãŸã ã‘ã§ãªãã€æ•°ãˆåˆ‡ã‚Œãªã„ãã‚‰ã„å¤šãã®è¨˜äº‹ã§è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ã€‚
:::

## äº‹å‰æº–å‚™

ã¾ãšã¯ä»Šå›ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§åˆ©ç”¨ã™ã‚‹ Dockerfile ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ GitHub ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```
git clone git@github.com:richardimaoka/tutorial-docker-cmd-entrypoint.git
cd tutorial-docker-cmd-entrypoint
```

## CMD ã®å‹•ä½œç†è§£

ã¾ãšã¯ CMD ã ã‘ã‚’å…ˆã«ç†è§£ã™ã‚‹ãŸã‚ã€ã„ã£ãŸã‚“ ENTRYPOINT ã®ã“ã¨ã‚’å¿˜ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ä¸¡è€…ãŒã¨ã¦ã‚‚ä¼¼ã¦ã„ã¦ã€åŒæ™‚ã«ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ··ä¹±ã™ã‚‹ã‹ã‚‰ã§ã™ã€‚

### JSON array å½¢å¼ã® exec form

```dockerfile:Dockerfile.cmd1
FROM ubuntu
CMD ["echo", "abc"]
```

ä¸Šè¨˜ã® Dockerfile ã‚’ build ã—ã¦ run ã—ã¾ã—ã‚‡ã†ã€‚å†’é ­ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸ GitHub ãƒ¬ãƒã‚¸ãƒˆãƒªã« Dockerfile.cmd1 ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd1 -f Dockerfile.cmd1 .
docker run --rm cmd1
```

```:docker runã®çµæœ
abc
```

æ¬¡ã¯ã“ã¡ã‚‰ã® Dockerfile ã§ã™ã€‚echo ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™å¼•æ•°ãŒ 1 ã¤å¢—ãˆã¾ã—ãŸã€‚

```dockerfile:Dockerfile.cmd2
FROM ubuntu
CMD ["echo", "abc", "def"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd2 -f Dockerfile.cmd2 .
docker run --rm cmd2
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc def
```

ä¸Šè¨˜ 2 ä¾‹ã® Dockerfile ã® CMD ã¯ exec form ã¨å‘¼ã°ã‚Œã‚‹å½¢å¼ã§ã€[Dockerfile ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/builder/#cmd)ã«ã€

> this is the preferred form

ã¨ã‚ã‚‹ã‚ˆã†ã«ã€CMD ã®è¨˜è¿°ã«ã¯åŸºæœ¬çš„ã«ã“ã® exec form ã‚’ä½¿ã†ã¹ãã§ã™ã€‚

### shell form

ã—ã‹ã—ã€CMD ã«ã¯ã‚‚ã†ä¸€ã¤ã€shell form ã¨å‘¼ã°ã‚Œã‚‹ä»¥ä¸‹ã®è¨˜æ³•ãŒã‚ã‚Šã¾ã™ã€‚

```dockerfile:Dockerfile.cmd3
FROM ubuntu
CMD echo "abc"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd3 -f Dockerfile.cmd3 .
docker run --rm cmd3
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc
```

shell form ã§ 2 ã¤ã®å¼•æ•°ã‚’æ¸¡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd4
FROM ubuntu
CMD echo "abc" "def"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd4 -f Dockerfile.cmd4 .
docker run --rm cmd4
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc def
```

### shell form ã¨ exec form ã«ã‚ˆã‚‹ã‚·ã‚§ãƒ«å¤‰æ•°å±•é–‹

shell form ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ã‚§ãƒ«å¤‰æ•°ã®å±•é–‹ã‚‚å‡ºæ¥ã¾ã™ã€‚

```dockerfile:Dockerfile.cmd5
FROM ubuntu
CMD echo "$HOME"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd5 -f Dockerfile.cmd5 .
docker run --rm cmd5
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
/home/your_username
```

ã‚·ã‚§ãƒ«å¤‰æ•°ã®å±•é–‹ã‚’ exec form ã§è¡Œã†ã¨ãªã‚‹ã¨ã€å°‘ã—ã ã‘é¢å€’ãªè¨˜è¿°ã«ãªã‚Šã¾ã™ã€‚

```dockerfile:Dockerfile.cmd6
FROM ubuntu
CMD [ "sh", "-c", "echo $HOME" ]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd6 -f Dockerfile.cmd6 .
docker run --rm cmd6
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
/home/your_username
```

### ãªãœ exec form ã‚’å„ªå…ˆã™ã¹ãã§ã€shell form ã¯ãã†ã§ã¯ãªã„ã®ã‹ï¼Ÿ

ã“ã“ã¾ã§ exec form ã§ã‚‚ shell form ã§ã‚‚åŒã˜ã“ã¨ãŒå‡ºæ¥ã‚‹ä¾‹ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯ä¸¡è€…ã®é•ã„ã¨ã€exec form ã‚’å„ªå…ˆã™ã¹ãç†ç”±ã®ä¸€ã¤ã‚’èª¬æ˜ã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull nginx
docker inspect nginx
```

nginx ã® Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ CMD ã® exec form ã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Config": {
    "Cmd": [
        "nginx",
        "-g",
        "daemon off;"
    ]
}
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run nginx:1.23.1
```

ã“ã‚Œã§ã€nginx ã«ã‚ˆã‚‹ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 07:14:58 [notice] 1#1: using the "epoll" event method
2022/09/03 07:14:58 [notice] 1#1: nginx/1.23.1
2022/09/03 07:14:58 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)
2022/09/03 07:14:58 [notice] 1#1: OS: Linux 5.10.102.1-microsoft-standard-WSL2
2022/09/03 07:14:58 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2022/09/03 07:14:58 [notice] 1#1: start worker processes
2022/09/03 07:14:58 [notice] 1#1: start worker process 31
2022/09/03 07:14:58 [notice] 1#1: start worker process 32
2022/09/03 07:14:58 [notice] 1#1: start worker process 33
2022/09/03 07:14:58 [notice] 1#1: start worker process 34
2022/09/03 07:14:58 [notice] 1#1: start worker process 35
2022/09/03 07:14:58 [notice] 1#1: start worker process 36
2022/09/03 07:14:58 [notice] 1#1: start worker process 37
2022/09/03 07:14:58 [notice] 1#1: start worker process 38
```

nginx ã‚’åœæ­¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
Ctrl + c
```

ã“ã‚Œã§ SIGINT ãŒé€ã‚‰ã‚Œâ€¦

```:ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Ÿè¡Œçµæœ
2022/09/03 07:15:40 [notice] 1#1: signal 2 (SIGINT) received, exiting
2022/09/03 07:15:40 [notice] 1#1: signal 14 (SIGALRM) received
...
...
2022/09/03 07:15:40 [notice] 1#1: worker process 38 exited with code 0
2022/09/03 07:15:40 [notice] 1#1: exit
```

â€¦nginx ãŒåœæ­¢ã—ã¾ã—ãŸã€‚

Ctrl+c ã§ãã‚Œã„ã«åœæ­¢ã§ãã‚‹ã®ã¯ã€nginx ã® docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒ CMD ã® exec form ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

ãã‚Œã§ã¯ã€shell form ã‚’ä½¿ã£ã¦ nginx ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã©ã†ãªã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd-nginx
FROM nginx:1.23.1
CMD nginx -g "daemon off;"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd-nginx -f Dockerfile.cmd-nginx .
docker run --rm cmd-nginx
```

```:ä»¥ä¸‹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
Ctrl + c
```

```å®Ÿè¡Œçµæœ
2022/09/03 05:48:46 [notice] 7#7: start worker process 13
2022/09/03 05:48:46 [notice] 7#7: start worker process 14
2022/09/03 05:48:46 [notice] 7#7: start worker process 15
^C
```

nginx ãŒåœæ­¢ã—ã¾ã›ã‚“ï¼

ä»£ã‚ã‚Šã«ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ docker stop ã‚’å®Ÿè¡Œã™ã‚Œã°ã“ã‚Œã‚’åœæ­¢ã§ãã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker stop cnt-cmd-nginx
```

å…ˆã»ã©ã¨é•ã£ã¦`signal 2 (SIGINT) received, exiting`ã¨ã¯è¡¨ç¤ºã•ã‚Œãšã«ã€æ€¥ã« nginx ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œãªããªã‚Šåœæ­¢ã—ã¾ã—ãŸã€‚

:::details docker stop ã§åœæ­¢ã§ãã‚‹ç†ç”±

[docker stop ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/commandline/stop/#description)ã«ã‚ã‚‹ã¨ãŠã‚Šã€æœ€åˆã« SIGTERM ãŒé€ã‚‰ã‚Œã‚‹ã®ã§ã™ãŒâ€¦

> The main process inside the container will receive SIGTERM, and after a grace period, SIGKILL. The first signal can be changed with the STOPSIGNAL instruction in the containerâ€™s Dockerfile, or the --stop-signal option to docker run.

â€¦CMD ã« shell form ã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã‚Š SIGTERM ã¯ç„¡è¦–ã•ã‚Œ(ç†ç”±ã¯å¾Œè¿°)ã€2 ç•ªã‚ã«é€ã‚‰ã‚Œã‚‹ SIGKILL ã«ã‚ˆã£ã¦ nginx ãŒå¼·åˆ¶çµ‚äº†ã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚
:::

:::details Ctrl+c ã§é€ã£ãŸã®ã¯ SIGINT ã§ã‚ã‚Š SIGTERM ã§ã¯ãªã„ã®ã§ã€æ¯”è¼ƒã«ãªã£ã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ

SIGINT ã§ã‚‚ SIGTERM ã§ã»ã¼åŒã˜çµæœã«ãªã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run nginx
```

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§`docker kill`ã‚’ä½¿ã£ã¦ SIGTERM ã‚’é€ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGTERM cnt-cmd-nginx
```

SIGTERM ã§ã‚‚ SIGINT ã¨åŒæ§˜ nginx ã¯åœæ­¢ã—ã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 06:04:49 [notice] 1#1: signal 15 (SIGTERM) received, exiting
2022/09/03 06:04:49 [notice] 31#31: exiting
...
...
2022/09/03 06:04:49 [notice] 1#1: worker process 38 exited with code 0
2022/09/03 06:04:49 [notice] 1#1: exit
```

ãã‚Œã§ã¯ã€shell form ã‚’ä½¿ã£ãŸå ´åˆã« Ctrl+c ã§é€ä¿¡ã•ã‚Œã‚‹ SIGINT ã‚’é€ä¿¡ã™ã‚‹ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ï¼Ÿ

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd-nginx -f Dockerfile.cmd-nginx .
docker run --name cnt-cmd-nginx cmd-nginx
```

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§`docker kill`ã‚’ä½¿ã£ã¦ SIGINT ã‚’é€ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGINT cnt-cmd-nginx
```

shell form ã§ã¯ã€SIGTERM åŒæ§˜ SIGINT ã‚‚ç„¡è¦–ã•ã‚Œã€nginx ã¯èµ°ã‚Šç¶šã‘ã¾ã™ã€‚

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 05:48:46 [notice] 7#7: start worker process 14
2022/09/03 05:48:46 [notice] 7#7: start worker process 15
```

:::

ä»¥ä¸Šã®ã‚ˆã†ã«ã€ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚Œãªããªã£ã¦ã—ã¾ã†ã“ã¨ãŒã€shell form ã®æ¬ ç‚¹ã§ã‚ã‚Šã€exec form ã‚’ä½¿ã†ã¹ãå¤§ããªç†ç”±ã§ã™ã€‚

### exec form ã¨ shell form ã® PID 1 ã‚’æ¯”è¼ƒã™ã‚‹

shell form ã§ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚Œãªããªã£ã¦ã—ã¾ã†ã®ã¯ã€CMD ã§æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ—ãƒ­ã‚»ã‚¹ ID`PID 1`ã«ãªã‚‰ãªã„ã‹ã‚‰ã§ã™ã€‚

exec form ã§ã€CMD ã®ã‚³ãƒãƒ³ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠå†…ã®`PID 1`ã®ä¸€è‡´ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd7
FROM ubuntu
CMD ["tail", "-f", "/dev/null"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd7 -f Dockerfile.cmd7 .
docker run --name cnt-cmd7 --rm cmd7
```

ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãšãƒ—ãƒ­ã‚»ã‚¹ãŒç«‹ã¡ä¸ŠãŒã£ãŸã¾ã¾ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker exec -it cnt-cmd7 /bin/sh
```

ã“ã‚Œã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šè¾¼ã‚ãŸã®ã§ã€`ps` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
ps -eaf
```

CMD ã§æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰`tail`ãŒ`PID 1`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 06:49 ?        00:00:00 tail -f /dev/null
root         7     0  1 06:50 pts/0    00:00:00 /bin/sh
root        13     7  0 06:50 pts/0    00:00:00 ps -eaf
```

ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰æŠœã‘ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
exit
```

`tail` ã‚³ãƒãƒ³ãƒ‰ã¯ `nginx` ã¨ã¯é•ã£ã¦ `SIGTERM`ã‚’å—ã‘ä»˜ã‘ã¦çµ‚äº†ã—ã¦ãã‚Œãªã„ã®ã§ã€`SIGKILL`ã§å¼·åˆ¶çµ‚äº†ã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGKILL cnt-cmd7
```

æ¬¡ã«ã€shell form ã® CMD ã§ã™ã€‚`PID 1`ãŒ`tail`ã«ãªã‚‰ãªã„ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd8
FROM ubuntu
CMD tail -f /dev/null
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd8 -f Dockerfile.cmd8 .
docker run --name cnt-cmd8 --rm cmd8
```

ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãšã«ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒç«‹ã¡ä¸ŠãŒã£ãŸã¾ã¾ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker exec -it cnt-cmd8 /bin/sh
```

ã“ã‚Œã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šè¾¼ã‚ãŸã®ã§ã€`ps` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
ps -eaf
```

æ³¨æ„ã—ã¦ã¿ãªã„ã¨åˆ†ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€`PID 1`ãŒ`/bin/sh`ã«ãªã£ã¦ã„ã¾ã™ã€‚`tail`ã¯`PID 7`ã§ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 06:37 ?        00:00:00 /bin/sh -c tail -f /dev/null
root         7     1  0 06:37 ?        00:00:00 tail -f /dev/null
root         8     0  0 06:40 pts/0    00:00:00 /bin/sh
root        15     8  0 06:41 pts/0    00:00:00 ps -eaf
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
exit
```

`SIGKILL`ã§å¼·åˆ¶çµ‚äº†ã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGKILL cnt-cmd8
```

## ENTRYPOINT ã®å‹•ä½œç†è§£

CMD ã®æ¬¡ã¯ ENTRYPOINT ã®å‹•ä½œç†è§£ã§ã™ã€‚ã“ã“ã§ã‚‚ ENTRYPOINT ã®å‹•ä½œã ã‘ã«é›†ä¸­ã—ã¦ã€CMD ã®ã“ã¨ã¯å¿˜ã‚Œã¾ã™ã€‚

### JSON array å½¢å¼ã® exec form

```dockerfile:Dockerfile.entrypoint1
FROM ubuntu
ENTRYPOINT ["echo", "abc"]
```

ä¸Šè¨˜ã® Dockerfile ã‚’ build ã—ã¦ run ã—ã¾ã—ã‚‡ã†

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint1 -f Dockerfile.entrypoint1 .
docker run --rm entrypoint1
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc
```

æ¬¡ã¯ã“ã¡ã‚‰ã® Dockerfile ã§ã™ã€‚echo ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™å¼•æ•°ãŒ 1 ã¤å¢—ãˆã¾ã—ãŸã€‚

```dockerfile:Dockerfile.entrypoint2
FROM ubuntu
ENTRYPOINT ["echo", "abc", "def"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint2 -f Dockerfile.entrypoint2 .
docker run --rm entrypoint2
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc def
```

ä¸Šè¨˜ 2 ä¾‹ã® Dockerfile ã® ENTRYPOINT ã¯ exec form ã¨å‘¼ã°ã‚Œã‚‹å½¢å¼ã§ã€[Dockerfile ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](The exec form, which is the preferred form:)ã«ã€

> The exec form, which is the preferred form

ã¨ã‚ã‚‹ã‚ˆã†ã«ã€ENTRYPOINT ã®è¨˜è¿°ã‚‚åŸºæœ¬çš„ã«ã“ã® exec form ã‚’ä½¿ã†ã¹ãã§ã™ã€‚

### shell form

ENTRYPOINT ã«ã¯ã‚‚ã†ä¸€ã¤ã€shell form ã¨å‘¼ã°ã‚Œã‚‹ä»¥ä¸‹ã®è¨˜æ³•ãŒã‚ã‚Šã¾ã™ã€‚

```dockerfile:Dockerfile.entrypoint3
FROM ubuntu
ENTRYPOINT echo "abc"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint3 -f Dockerfile.entrypoint3 .
docker run --rm entrypoint3
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc
```

shell form ã§ 2 ã¤ã®å¼•æ•°ã‚’æ¸¡ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.entrypoint4
FROM ubuntu
ENTRYPOINT echo "abc" "def"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint4 -f Dockerfile.entrypoint4 .
docker run --rm entrypoint4
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc def
```

### shell form ã¨ exec form ã«ã‚ˆã‚‹ã‚·ã‚§ãƒ«å¤‰æ•°å±•é–‹

shell form ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ã‚§ãƒ«å¤‰æ•°ã®å±•é–‹ã‚‚å‡ºæ¥ã¾ã™ã€‚

```dockerfile:Dockerfile.entrypoint5
FROM ubuntu
ENTRYPOINT echo "$HOME"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint5 -f Dockerfile.entrypoint5 .
docker run --rm entrypoint5
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
/home/your_username
```

ã‚·ã‚§ãƒ«å¤‰æ•°ã®å±•é–‹ã‚’ exec form ã§è¡Œã†ã¨ãªã‚‹ã¨ã€å°‘ã—ã ã‘é¢å€’ãªè¨˜è¿°ã«ãªã‚Šã¾ã™ã€‚

```dockerfile:Dockerfile.entrypoint6
FROM ubuntu
ENTRYPOINT [ "sh", "-c", "echo $HOME" ]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint6 -f Dockerfile.entrypoint6 .
docker run --rm entrypoint6
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
/home/your_username
```

### ãªãœ exec form ã‚’å„ªå…ˆã™ã¹ãã§ã€shell form ã¯ãã†ã§ã¯ãªã„ã®ã‹ï¼Ÿ

ã“ã“ã¾ã§ exec form ã§ã‚‚ shell form ã§ã‚‚åŒã˜ã“ã¨ãŒå‡ºæ¥ã‚‹ä¾‹ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯ä¸¡è€…ã®é•ã„ã¨ã€exec form ã‚’å„ªå…ˆã™ã¹ãç†ç”±ã®ä¸€ã¤ã‚’èª¬æ˜ã—ã¾ã™ã€‚

```dockerfile:Dockerfile.entrypoint-nginx1
FROM nginx:1.23.1
ENTRYPOINT [ "nginx", "-g", "daemon off;"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint-nginx1 -f Dockerfile.entrypoint-nginx1 .
docker inspect entrypoint-nginx1
```

ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã® nginx ã«ã¯ CMD ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€`Dockerfile.entrypoint-nginx1`ã§ ENTRYPOINT ã‚’æŒ‡å®šã—ãŸãŸã‚ã€CMD ã¯ null ã«ãªã‚Šã€ENTRYPOINT ã®ã¿ãŒæ®‹ã‚Šã¾ã—ãŸã€‚

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Config": {
    ...
    "Cmd": null,
    "Entrypoint": [
        "nginx",
        "-g",
        "daemon off;"
    ]
}
```

[Dockerfile ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/builder/#understand-how-cmd-and-entrypoint-interact)ã«ã‚‚ä¸‹è¨˜ã®è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã€‚

> If CMD is defined from the base image, setting ENTRYPOINT will reset CMD to an empty value.

ãã‚Œã§ã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --rm entrypoint-nginx1
```

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 07:14:58 [notice] 1#1: using the "epoll" event method
2022/09/03 07:14:58 [notice] 1#1: nginx/1.23.1
2022/09/03 07:14:58 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)
2022/09/03 07:14:58 [notice] 1#1: OS: Linux 5.10.102.1-microsoft-standard-WSL2
2022/09/03 07:14:58 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576
2022/09/03 07:14:58 [notice] 1#1: start worker processes
2022/09/03 07:14:58 [notice] 1#1: start worker process 31
2022/09/03 07:14:58 [notice] 1#1: start worker process 32
2022/09/03 07:14:58 [notice] 1#1: start worker process 33
2022/09/03 07:14:58 [notice] 1#1: start worker process 34
2022/09/03 07:14:58 [notice] 1#1: start worker process 35
2022/09/03 07:14:58 [notice] 1#1: start worker process 36
2022/09/03 07:14:58 [notice] 1#1: start worker process 37
2022/09/03 07:14:58 [notice] 1#1: start worker process 38
```

nginx ã‚’åœæ­¢ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
Ctrl + c
```

ã“ã‚Œã§ SIGINT ãŒé€ã‚‰ã‚Œâ€¦

```:ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå®Ÿè¡Œçµæœ
2022/09/03 07:15:40 [notice] 1#1: signal 2 (SIGINT) received, exiting
2022/09/03 07:15:40 [notice] 1#1: signal 14 (SIGALRM) received
...
...
2022/09/03 07:15:40 [notice] 1#1: worker process 38 exited with code 0
2022/09/03 07:15:40 [notice] 1#1: exit
```

â€¦nginx ãŒåœæ­¢ã—ã¾ã—ãŸã€‚

Ctrl+c ã§ãã‚Œã„ã«åœæ­¢ã§ãã‚‹ã®ã¯ã€å…ˆç¨‹ãƒ•ã‚¡ã‚¤ãƒ«`Dockerfile.entrypoint-nginx1`ã§è¦‹ãŸã‚ˆã†ã«ã€ENTRYPOINT ã® exec form ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

ãã‚Œã§ã¯ã€shell form ã‚’ä½¿ã£ã¦ nginx ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã©ã†ãªã‚‹ã‹è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.entrypoint-nginx2
FROM nginx:1.23.1
ENTRYPOINT nginx -g "daemon off;"
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint-nginx2 -f Dockerfile.entrypoint-nginx2 .
docker run --name cnt-entrypoint-nginx2 --rm entrypoint-nginx2
```

```:ä»¥ä¸‹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
Ctrl + c
```

```å®Ÿè¡Œçµæœ
2022/09/03 05:48:46 [notice] 7#7: start worker process 13
2022/09/03 05:48:46 [notice] 7#7: start worker process 14
2022/09/03 05:48:46 [notice] 7#7: start worker process 15
^C
```

nginx ãŒåœæ­¢ã—ã¾ã›ã‚“ï¼

ä»£ã‚ã‚Šã«ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ docker stop ã‚’å®Ÿè¡Œã™ã‚Œã°ã“ã‚Œã‚’åœæ­¢ã§ãã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker stop cnt-entrypoint-nginx2
```

å…ˆã»ã©ã¨é•ã£ã¦`signal 2 (SIGINT) received, exiting`ã¨ã¯è¡¨ç¤ºã•ã‚Œãšã«ã€æ€¥ã« nginx ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œãªããªã‚Šåœæ­¢ã—ã¾ã—ãŸã€‚

:::details docker stop ã§åœæ­¢ã§ãã‚‹ç†ç”±

[docker stop ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/commandline/stop/#description)ã«ã‚ã‚‹ã¨ãŠã‚Šã€æœ€åˆã« SIGTERM ãŒé€ã‚‰ã‚Œã‚‹ã®ã§ã™ãŒâ€¦

> The main process inside the container will receive SIGTERM, and after a grace period, SIGKILL. The first signal can be changed with the STOPSIGNAL instruction in the containerâ€™s Dockerfile, or the --stop-signal option to docker run.

â€¦ENTRYPOINT ã« shell form ã‚’ä½¿ã£ã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã‚Š SIGTERM ã¯ç„¡è¦–ã•ã‚Œ(ç†ç”±ã¯å¾Œè¿°)ã€2 ç•ªã‚ã«é€ã‚‰ã‚Œã‚‹ SIGKILL ã«ã‚ˆã£ã¦ nginx ãŒå¼·åˆ¶çµ‚äº†ã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚
:::

:::details Ctrl+c ã§é€ã£ãŸã®ã¯ SIGINT ã§ã‚ã‚Š SIGTERM ã§ã¯ãªã„ã®ã§ã€æ¯”è¼ƒã«ãªã£ã¦ã„ãªã„ã®ã§ã¯ï¼Ÿ

SIGINT ã§ã‚‚ SIGTERM ã§ã»ã¼åŒã˜çµæœã«ãªã‚Šã¾ã™ã€‚Ctrl+c = SIGINT ã§åœæ­¢ã—ãŸ exec form ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã€SIGTERM ã§åœæ­¢ã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --name cnt-entrypoint-nginx1 --rm entrypoint-nginx1
```

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§`docker kill`ã‚’ä½¿ã£ã¦ SIGTERM ã‚’é€ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGTERM cnt-entrypoint-nginx1
```

SIGTERM ã§ã‚‚ SIGINT ã¨åŒæ§˜ nginx ã¯åœæ­¢ã—ã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 06:04:49 [notice] 1#1: signal 15 (SIGTERM) received, exiting
2022/09/03 06:04:49 [notice] 31#31: exiting
...
...
2022/09/03 06:04:49 [notice] 1#1: worker process 38 exited with code 0
2022/09/03 06:04:49 [notice] 1#1: exit
```

ãã‚Œã§ã¯ã€shell form ã‚’ä½¿ã£ãŸå ´åˆã« Ctrl+c ã§é€ä¿¡ã•ã‚Œã‚‹ SIGINT ã‚’é€ä¿¡ã™ã‚‹ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ï¼Ÿ

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --name cnt-entrypoint-nginx2 --rm entrypoint-nginx2
```

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§`docker kill`ã‚’ä½¿ã£ã¦ SIGINT ã‚’é€ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGINT cnt-entrypoint-nginx2
```

shell form ã§ã¯ã€SIGTERM åŒæ§˜ SIGINT ã‚‚ç„¡è¦–ã•ã‚Œã€nginx ã¯èµ°ã‚Šç¶šã‘ã¾ã™ã€‚

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
2022/09/03 05:48:46 [notice] 7#7: start worker process 14
2022/09/03 05:48:46 [notice] 7#7: start worker process 15
```

:::

ä»¥ä¸Šã®ã‚ˆã†ã«ã€ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚Œãªããªã£ã¦ã—ã¾ã†ã“ã¨ãŒã€shell form ã®æ¬ ç‚¹ã§ã‚ã‚Šã€exec form ã‚’ä½¿ã†ã¹ãå¤§ããªç†ç”±ã§ã™ã€‚

### exec form ã¨ shell form ã® PID 1 ã‚’æ¯”è¼ƒã™ã‚‹

shell form ã§ãƒ—ãƒ­ã‚»ã‚¹ãƒ»ã‚·ã‚°ãƒŠãƒ«ã‚’å—ã‘å–ã‚Œãªããªã£ã¦ã—ã¾ã†ã®ã¯ã€ENTRYPOINT ã§æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ãŒã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ—ãƒ­ã‚»ã‚¹ ID`PID 1`ã«ãªã‚‰ãªã„ã‹ã‚‰ã§ã™ã€‚

exec form ENTRYPOINT ã®ã‚³ãƒãƒ³ãƒ‰ã¨ã‚³ãƒ³ãƒ†ãƒŠå†…ã®`PID 1`ã®ä¸€è‡´ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.entrypoint7
FROM ubuntu
ENTRYPOINT ["tail", "-f", "/dev/null"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint7 -f Dockerfile.entrypoint7 .
docker run --name cnt-entrypoint7 --rm entrypoint7
```

ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãšãƒ—ãƒ­ã‚»ã‚¹ãŒç«‹ã¡ä¸ŠãŒã£ãŸã¾ã¾ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker exec -it cnt-entrypoint7 /bin/sh
```

ã“ã‚Œã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šè¾¼ã‚ãŸã®ã§ã€`ps` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
ps -eaf
```

ENTRYPOINT ã§æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰`tail`ãŒ`PID 1`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 06:49 ?        00:00:00 tail -f /dev/null
root         7     0  1 06:50 pts/0    00:00:00 /bin/sh
root        13     7  0 06:50 pts/0    00:00:00 ps -eaf
```

ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰æŠœã‘ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
exit
```

`tail` ã‚³ãƒãƒ³ãƒ‰ã¯ `nginx` ã¨ã¯é•ã£ã¦ `SIGTERM`ã‚’å—ã‘ä»˜ã‘ã¦çµ‚äº†ã—ã¦ãã‚Œãªã„ã®ã§ã€`SIGKILL`ã§å¼·åˆ¶çµ‚äº†ã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGKILL cnt-entrypoint7
```

æ¬¡ã«ã€shell form ã® ENTRYPOINT ã§ã™ã€‚`PID 1`ãŒ`tail`ã«ãªã‚‰ãªã„ã“ã¨ã‚’ç¢ºã‹ã‚ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.entrypoint8
FROM ubuntu
ENTRYPOINT tail -f /dev/null
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint8 -f Dockerfile.entrypoint8 .
docker run --name cnt-entrypoint8 --rm entrypoint8
```

ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãšã«ã€ãƒ—ãƒ­ã‚»ã‚¹ãŒç«‹ã¡ä¸ŠãŒã£ãŸã¾ã¾ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker exec -it cnt-entrypoint8 /bin/sh
```

ã“ã‚Œã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã«å…¥ã‚Šè¾¼ã‚ãŸã®ã§ã€`ps` ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠå†…éƒ¨ã®ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
ps -eaf
```

æ³¨æ„ã—ã¦ã¿ãªã„ã¨åˆ†ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€`PID 1`ãŒ`/bin/sh`ã«ãªã£ã¦ã„ã¾ã™ã€‚`tail`ã¯`PID 7`ã§ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 06:37 ?        00:00:00 /bin/sh -c tail -f /dev/null
root         7     1  0 06:37 ?        00:00:00 tail -f /dev/null
root         8     0  0 06:40 pts/0    00:00:00 /bin/sh
root        15     8  0 06:41 pts/0    00:00:00 ps -eaf
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
exit
```

`SIGKILL`ã§å¼·åˆ¶çµ‚äº†ã—ã¾ã™ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker kill --signal SIGKILL cnt-entrypoint8
```

## CMD ã¨ ENTRYPOINT ä¸¡æ–¹ã‚’æŒ‡å®šã™ã‚‹å ´åˆã®å‹•ä½œç†è§£

ã“ã“ã¾ã§ã®ä¾‹ã§ã¯ CMD ã‚‚ ENTRYPOINT ã‚‚ã»ã¼åŒã˜å‹•ä½œã‚’ã—ã¾ã—ãŸã€‚ã“ã‚Œã§ã¯ã€ãªãœä¼¼ãŸã‚ˆã†ãªã‚‚ã®ãŒ 2 ã¤å­˜åœ¨ã™ã‚‹ã‹ç†ç”±ãŒã‚ã‹ã‚‰ãªã„ã¨æ€ã†ã®ã§ã€2 ã¤ã‚’çµ„ã¿åˆã‚ã›ãŸä½¿ã„æ–¹ã‚’å­¦ã‚“ã§ã¿ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd-and-entrypoint1
FROM ubuntu
ENTRYPOINT [ "echo" ]
CMD ["abc"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd-and-entrypoint1 -f Dockerfile.cmd-and-entrypoint1 .
docker run --rm cmd-and-entrypoint1
```

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc
```

ã“ã‚Œã¯ ENTRYPOINT ã® `echo` ãŒã‚³ãƒãƒ³ãƒ‰ã€CMD ã®`"abd"`ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã«ãªã£ã¦ã„ã¾ã™ã€‚[Dockerfile ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/builder/#cmd)ã«ã‚ã‚‹ã¨ãŠã‚Šã§ã™ã€‚

> If CMD is used to provide default arguments for the ENTRYPOINT instruction, both the CMD and ENTRYPOINT instructions should be specified with the JSON array format.

ãã‚Œã§ã¯ã€docker run æ™‚ã«å¼•æ•°ã‚’ä¸ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --rm cmd-and-entrypoint1 def
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã§ã‚ã‚‹ CMD ã®`"abc"`ã¯ç„¡è¦–ã•ã‚Œã€docker run ã§ä¸ãˆãŸ`"def"`ã®ã¿ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
def
```

ã•ã‚‰ã«è¿½åŠ ã®å¼•æ•°ã‚’ä¸ãˆã‚‹ã¨â€¦

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --rm cmd-and-entrypoint1 def ghi
```

â€¦ã“ã†ãªã‚Šã¾ã™

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
def ghi
```

ä»¥ä¸Šã®å‹•ä½œã‚’ CMD ã ã‘æŒ‡å®šã—ãŸã¨ãã®å‹•ä½œã¨æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å†’é ­ã§ä½¿ã£ãŸ`Dockerfile.cmd1`ã‚’å†æ²ã—ã¾ã™ã€‚

```dockerfile:Dockerfile.cmd1
FROM ubuntu
CMD ["echo", "abc"]
```

ã“ã‚Œã‚’ã€docker run ã§å¼•æ•°ã‚’ä¸ãˆã¦å®Ÿè¡Œã—ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd1 -f Dockerfile.cmd1 .
docker run --rm cmd1 def
```

`def`ãŒå¼•æ•°ã§ã¯ãªãã€ã‚³ãƒãƒ³ãƒ‰ã¨ã—ã¦è§£é‡ˆã•ã‚Œã¦ã—ã¾ã£ãŸãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
docker: Error response from daemon: failed to create shim task:
 OCI runtime create failed: runc create failed:
   unable to start container process: exec: "def":
     executable file not found in $PATH: unknown.
```

ãã‚Œã§ã¯ ENTRYPOINT ã ã‘ã®å ´åˆã¯ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ

```dockerfile:Dockerfile.entrypoint1
FROM ubuntu
ENTRYPOINT ["echo", "abc"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t entrypoint1 -f Dockerfile.entrypoint1 .
docker run --rm entrypoint1 def
```

ENTRYPOINT ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚ã‚‹ `echo abc`ã«æ›´ã«å¼•æ•°`def`ã‚’è¿½åŠ ã—ãŸçµæœã«ãªã‚Šã¾ã—ãŸã€‚

```:ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œçµæœ
abc def
```

ã“ã‚Œã¯ [Dockerfile ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://docs.docker.com/engine/reference/builder/#entrypoint)ã«ã‚ã‚‹ã¨ãŠã‚Šã§ã™ã€‚

> Command line arguments to docker run <image> will be appended after all elements in an exec form ENTRYPOINT, and will override all elements specified using CMD.

## CMD ã‚’ ENTRYPOINT ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¨ã™ã‚‹ä½¿ã„æ–¹

ENTRYPOINT ã¨ CMD ã‚’çµ„ã¿åˆã‚ã›ã‚Œã°ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã§æœ€ã‚‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¤ã¤ã€å¿…è¦ã«å¿œã˜ã¦å¼•æ•°ã‚’ä¸Šæ›¸ãã§ãã‚‹æŸ”è»Ÿæ€§ã‚’æŒã£ãŸã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã§ãã¾ã™ã€‚

`ping`ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`localhost`ã‚’ ping ã™ã‚‹ã¨ã—ã¾ã—ã‚‡ã†ã€‚

```dockerfile:Dockerfile.cmd-and-entrypoint2
FROM centos
ENTRYPOINT [ "ping" ]
CMD ["localhost"]
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker build -t cmd-and-entrypoint2 -f Dockerfile.cmd-and-entrypoint2 .
docker run --rm cmd-and-entrypoint2
```

```:å®Ÿè¡Œçµæœ
PING localhost (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=5.09 ms
64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.027 ms
64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.023 ms
64 bytes from localhost (127.0.0.1): icmp_seq=4 ttl=64 time=0.021 ms
```

ping å‡ºæ¥ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã®ã§ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’æ­¢ã‚ã¾ã—ã‚‡ã†ã€‚

```:ä»¥ä¸‹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
Ctrl + c
```

ã“ã‚ŒãŒã‚‚ã—ä»¥ä¸‹ã®ã‚ˆã†ãª Dockerfile ã§ã‚ã‚Œã°ã€localhost ã—ã‹ ping å‡ºæ¥ãªã„ã‚³ãƒ³ãƒ†ãƒŠã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```dockerfile:Dockerfile.cmd-and-entrypoint3
FROM ubuntu
ENTRYPOINT [ "ping", "localhost"]
```

å®Ÿéš›ã«ã¯ ping ã®ãŸã‚ã ã‘ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œã‚‹ã“ã¨ã¯ãªã„ã§ã—ã‚‡ã†ãŒã€ENTRYPOINT ã« docker run ã§ä¸Šæ›¸ãã—ãŸã„å¼•æ•°éƒ¨åˆ†ã‚’å«ã¾ãªã„ã‚ˆã†ã«ã™ã‚‹ã€ä¸Šæ›¸ãã—ãŸã„éƒ¨åˆ†ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¼•æ•°ã¨ã—ã¦ CMD ã§ä¸ãˆã‚‹ã¨ã„ã†ã®ã¯é‡è¦ã«ãªã‚Šã¾ã™ã€‚

## å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å­¦ã¶

https://hub.docker.com/search?image_filter=official&q=

![Supported-Dockerfile-links.png](/images/bd87036acd951e/Supported-Dockerfile-links.png)

### nginx

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull nginx
docker inspect nginx
```

```:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "nginx",
    "-g",
    "daemon off;"
],
"Entrypoint": [
    "/docker-entrypoint.sh"
],
```

https://github.com/nginxinc/docker-nginx/blob/master/entrypoint/docker-entrypoint.sh

### httpd

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull httpd
docker inspect httpd
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "httpd-foreground"
],
"Entrypoint": null,
```

### python

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull python
docker inspect python
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "python3"
],
"Entrypoint": null,
```

### golang

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull golang
docker inspect golang
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "bash"
],
"Entrypoint": null,
```

### openjdk

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull openjdk
docker inspect openjdk
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "jshell"
],
"Entrypoint": null,
```

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker run --rm oepnjdk
```

```
INFO: Created user preferences directory.
|  Welcome to JShell -- Version 18.0.2.1
|  For an introduction type: /help intro

jshell> %
```

### gradle

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull gradle
docker inspect gradle
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
            "Cmd": [
                "gradle"
            ],
            "Image": "sha256:0a30bb4eec6fc44a88a3e1b48424789fe89334a4f19592bec4107691665c598d",
            "Volumes": {
                "/home/gradle/.gradle": {}
            },
            "WorkingDir": "/home/gradle",
            "Entrypoint": null,
```

### ubuntu

https://hub.docker.com/_/ubuntu

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull ubuntu
docker inspect ubuntu
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "bash"
],
"Entrypoint": null,
```

### centos

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull centos
docker inspect centos
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
"Cmd": [
    "/bin/bash"
],
"Entrypoint": null,
```

### mysql

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull mysql
docker inspect mysql
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
            "Cmd": [
                "mysqld"
            ],
            "Entrypoint": [
                "docker-entrypoint.sh"
            ],
```

https://github.com/docker-library/mysql/blob/master/5.7/docker-entrypoint.sh

### postgres

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull postgres
docker inspect postgres
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
        "Cmd": [
                "postgres"
            ],
            "Image": "sha256:2b3c80c9f20f867d65833c58189039189df455c2936fc21346339625da98a58f",
            "Volumes": {
                "/var/lib/postgresql/data": {}
            },
            "WorkingDir": "",
            "Entrypoint": [
                "docker-entrypoint.sh"
            ],
            "OnBuild": null,
            "Labels": null,
            "StopSignal": "SIGINT"
        },
        "Architecture": "amd64",
```

### memcached

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull memcached
docker inspect memcached
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
            "Cmd": [
                "memcached"
            ],
            "Image": "sha256:2d659d0f0bb5070f84c4193388cf7289fc0323dfa891867d82dbc73eea1bb0ae",
            "Volumes": null,
            "WorkingDir": "",
            "Entrypoint": [
                "docker-entrypoint.sh"
            ],
```

### wordpress

```:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
docker pull wordpress
docker inspect wordpress
```

```ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
            "Cmd": [
                "apache2-foreground"
            ],
            "Image": "sha256:bce3ddb8707cc5bac629762b35b98ec4d532458317732189e7bb57856810eeb0",
            "Volumes": {
                "/var/www/html": {}
            },
            "WorkingDir": "/var/www/html",
            "Entrypoint": [
                "docker-entrypoint.sh"
            ],
```
