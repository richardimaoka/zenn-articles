---
title: "protobufã¨grpcã®Goã‚³ãƒ¼ãƒ‰ç”Ÿæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®šã‚’ã€protocã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è¡Œã†"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["protobuf", "grpc"]
published: true
---

[gRPC å…¬å¼ã® Quick start](https://grpc.io/docs/languages/go/quickstart/)ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã¡ã‚‡ã£ã¨è¤‡é›‘ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã ã ã‘ã§ã¯ãã¡ã‚“ã¨ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

```
protoc --go_out=. --go_opt=paths=source_relative \
  --go-grpc_out=. --go-grpc_opt=paths=source_relative \
  helloworld/helloworld.proto
```

ãã“ã§ã€æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰`protoc`ã‚³ãƒãƒ³ãƒ‰ã§ Go ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã¿ãŸè¨˜éŒ²ã‚’æœ¬è¨˜äº‹ã«ã¾ã¨ã‚ã¾ã™ã€‚

:::details ç°¡å˜ã®ãŸã‚ `--go_out` ã¨ `--go_opt` ã ã‘ã«æ³¨ç›®

å…ˆç¨‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ä»¥ä¸‹ã§ç¤ºã™ 2 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```
+ project_root_dir
  + helloworld
     | helloworld.proto
     | helloworld.pb.go      // <- ç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld_grpc.pb.go // <- ç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
```

`protoc`ã‚³ãƒãƒ³ãƒ‰ã® 4 ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³`--go_out` `--go_opt` `--go-grpc_out` `--go-grpc_opt` ã¯ã€ç”Ÿæˆã•ã‚ŒãŸ Go ã‚³ãƒ¼ãƒ‰ãŒã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã‚‹ã‹ã‚’åˆ¶å¾¡ã—ã¦ã„ã¦ã€ã¾ã¨ã‚ã‚‹ã¨ã“ã†ã§ã™ã€‚

|                     | `_out`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | `_opt` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«å    |
| ------------------- | ---------------- | ----------------- | ----------------- |
| protobuf ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ | `--go_out`       | `--go_opt`        | `hello.pb.go`     |
| grpc ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ     | `--go-grpc_out`  | `--go-grpc_opt`   | `hell_grpc.pb.go` |

å‰åŠ 2 ã¤ã®ã€Œprotobuf ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ã«é–¢ã‚ã‚‹`--go_out` ã¨ `--go_opt`ãŒç†è§£ã§ãã‚Œã°ã€å¾ŒåŠ 2 ã¤ã‚‚åŒæ™‚ã«ç†è§£ã§ãã¾ã™ã€‚ãã“ã§ã€æœ¬è¨˜äº‹ã§ã¯ã“ã‚Œã‚ˆã‚Šå…ˆã¯`--go_out` ã¨ `--go_opt`ã ã‘ã«æ³¨ç›®ã—ã¾ã™ã€‚

```
protoc --go_out=. --go_opt=paths=source_relative \
  helloworld/helloworld.proto
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã€æ³¨ç›®ã™ã¹ãã‚³ãƒãƒ³ãƒ‰ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸï¼

:::

## 0. äº‹å‰æº–å‚™

ã¾ãšã¯ä½œæ¥­ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æº–å‚™ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
mkdir protoc-go-experiments
cd protoc-go-experiments
```

ã¤ãã« `helloworld` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æº–å‚™ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
mkdir helloworld
cd helloworld # protoc-go-experiments/helloworld
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
+ protoc-go-experiments
  + helloworld # ã‚«ãƒ¬ãƒ³ãƒˆãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
```

ãã—ã¦`helloworld.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
# protoc-go-experiments/helloworld/helloworld.proto
cat << EOF > helloworld.proto
syntax = "proto3";

// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings
message HelloReply {
  string message = 1;
}
EOF
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã§æº–å‚™å®Œäº†ã§ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld # <- ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
     | helloworld.proto
```

## 1. `.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰`protoc`å®Ÿè¡Œ

ãã‚Œã§ã¯`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ã€`helloworld`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã‹ã‚‰`protoc`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
# protoc-go-experiments/helloworld ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ
protoc helloworld.proto # å¼•æ•°ã§`.proto`ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿æŒ‡å®š
```

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
Missing output directives.
```

### 1.1 ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã—ãªãŒã‚‰å‹•ä½œã‚’å­¦ã¶

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ `--go_out` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã§è§£æ±ºã§ãã¾ã™ã€‚

> The argument to the `go_out` flag is the directory where you want the compiler to write your Go output. - [Protocol Buffers å…¬å¼: Go Generated Code](https://developers.google.com/protocol-buffers/docs/reference/go-generated)

ã¾ãšã¯ã€Œ`--go_out=.`ã¨ã„ã†å½¢ã§ã€`=`ã®å³å´ã«ã¯`.`ã‚’ç½®ãã‚‚ã®ã§ã‚ã‚‹ã€ã¨ã„ã†å˜ç´”åŒ–ã—ãŸãƒ«ãƒ¼ãƒ«ã‚’ä»®å®šã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc --go_out=. helloworld.proto
```

ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
protoc-gen-go: unable to determine Go import path for "helloworld.proto"

Please specify either:
â€¢ a "go_package" option in the .proto source file, or
â€¢ a "M" argument on the command line.

See https://developers.google.com/protocol-buffers/docs/reference/go-generated#package for more information.
```

ä¸Šè¨˜ã®ãƒªãƒ³ã‚¯å…ˆ [https://developers.google.com/protocol-buffers/docs/reference/go-generated#package](https://developers.google.com/protocol-buffers/docs/reference/go-generated#package) ã«å¾“ã£ã¦ã€`.proto`ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§`go_package`ã‚’æŒ‡å®šã—ã¾ã—ã‚‡ã†ã€‚

::: details a "M" argument on the command line. ã¯ã©ã†ãªã‚‹ï¼Ÿ

```sh
Please specify either:
â€¢ a "go_package" option in the .proto source file, or
â€¢ a "M" argument on the command line.
```

ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ã‚ã‹ã‚‹ã‚ˆã†ã«ã€`go_package` ã®æŒ‡å®šä»¥å¤–ã«ã‚‚`"M"`ãƒ•ãƒ©ã‚°ã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã‚Šå…·ä½“çš„ã«ã¯`--go_opt`ã«`M${PROTO_FILE}=${GO_IMPORT_PATH}`ã¨ã„ã†å½¢å¼ã§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã§ã€ä¸Šè¨˜ãƒªãƒ³ã‚¯å…ˆã«ã‚‚èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚

ã—ã‹ã—ã€æœ¬è¨˜äº‹ã§ã¯`go_package` ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã®ã¿ã‚’è§£èª¬ã—ã€`--go_opt`ã«`M${PROTO_FILE}=${GO_IMPORT_PATH}`ã¨ã„ã†å½¢å¼ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã¯ã€æ©Ÿä¼šãŒã‚ã‚Œã°åˆ¥ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã€Œ

:::

[Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ»ãƒ‘ã‚¹ã®æ…£ç¿’](https://go.dev/blog/package-names)ã«å¾“ã†ã¨ã€ Go ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ (github.com å‰æã§é–‹ç™ºã™ã‚‹å ´åˆ) `github.com/__github_username` ä»¥ä¸‹ã«ä½œæˆã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€`go_package` ã‚’æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

```diff:helloworld.proto ã‚’æ›¸ãæ›ãˆã¦ä¸‹ã•ã„
syntax = "proto3";

// __github_username ã¯è‡ªèº«ã®ã‚‚ã®ã«ç½®ãæ›ãˆã¦ä¸‹ã•ã„ã€‚
+ option go_package = "github.com/__github_username /protoc-go-experiments/helloworld";

// The greeting service definition.
service Greeter {
```

ã‚‚ã†ä¸€åº¦å…ˆç¨‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc --go_out=. helloworld.proto
```

ä½¿ã„ã¥ã‚‰ãã†ãªæ·±ããƒã‚¹ãƒˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     + github.com # <- ã“ã‚Œä»¥ä¸‹ãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
        + __github_username
          + protoc-go-experiments
            + helloworld
              | helloworld.pb.go
```

ã„ã£ãŸã‚“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ç”Ÿæˆçµæœã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm -rf github.com
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### 1.2 `--go_opt`ã«`paths=source_relative`ã‚’æŒ‡å®š

ãƒã‚¹ãƒˆã‚’é¿ã‘ã‚‹ãŸã‚ã€`--go_opt`ã«`paths=source_relative`ã‚’ã¤ã‘ã¾ã™ã€‚

> If the `paths=source_relative` flag is specified, the output file is placed in the same relative directory as the input file. - [Protocol Buffers å…¬å¼: Go Generated Code](https://developers.google.com/protocol-buffers/docs/reference/go-generated)

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld.proto
```

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | helloworld.pb.go  # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
```

ãã‚Œã§ã¯ã“ã“ã§ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm helloworld.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### 1.3 `--go_out`ã®å¤‰æ›´

ã“ã‚Œã¾ã§ã¯ä»¥ä¸‹ã®ä»®å®šã®ã‚‚ã¨é€²ã‚ã¦ãã¾ã—ãŸã€‚

> ã¾ãšã¯ã€Œ`--go_out=.`ã¨ã„ã†å½¢ã§ã€`=`ã®å³å´ã«ã¯`.`ã‚’ç½®ãã‚‚ã®ã§ã‚ã‚‹ã€ã¨ã„ã†å˜ç´”åŒ–ã—ãŸãƒ«ãƒ¼ãƒ«ã‚’ä»®å®šã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€ãã®ä»®å®šã‚’å¤‰ãˆã¦ã€`--go_out`ã«é•ã†å€¤`outdir`ã‚’æŒ‡å®šã—ã¦ã¿ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=outdir --go_opt=paths=source_relative \
  helloworld.proto
```

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
outdir/: No such file or directory
```

`outdir`ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã§ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã€`outdir`ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
mkdir outdir
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     + outdir
```

å…ˆç¨‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚‚ã†ä¸€åº¦å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=outdir --go_opt=paths=source_relative \
  helloworld.proto
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     + outdir
       | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰o
```

ã“ã‚Œã§ã€`--go_opt=paths=source_relative`ã¨æŒ‡å®šã—ãŸã¨ãã«ã€`-go_out`ã§ã©ã®ã‚ˆã†ã« Go ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ¶å¾¡ã§ãã‚‹ã‹ã‚ã‹ã‚Šã¾ã—ãŸã€‚

ãã‚Œã§ã¯ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm -rf outdir
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### 1.4 ã“ã“ã¾ã§ã®ã¾ã¨ã‚

- Go ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã«ã¯`--go_out`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã€‚
- `--go_opt=paths=source_relative` ã‚’ã¤ã‘ã‚‹ã¨ `github.com/__github_username/...` ã¨ã„ã†æ·±ããƒã‚¹ãƒˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œãªããªã‚‹
- `--go_opt=paths=source_relative` ã®ã‚‚ã¨ã§ã€`--go_out=outidr`ã®ã‚ˆã†ãªæŒ‡å®šã§ã€Go ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ¶å¾¡ã§ãã‚‹

## 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰`protoc`ã‚’å®Ÿè¡Œ

å¤šãã® grpc åˆ©ç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰`protoc`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã¨æ€ã„ã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã‚‚ã“ã“ã‹ã‚‰ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•ã—ã¦`protoc`ã‚’è©¦ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
cd ../
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments # <- ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
  + helloworld
     | helloworld.proto
```

å…ˆã»ã©ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld.proto
```

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
helloworld.proto: No such file or directory
```

ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€å¼•æ•°`helloworld.proto`ã‚’`helloworld/helloworld.proto`ã«å¤‰ãˆã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/helloworld.proto
```

1. ã®ã¨ãã¨åŒã˜ç”Ÿæˆçµæœã‚’å†ç¾ã§ãã¾ã—ãŸã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
```

ãã‚Œã§ã¯ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm -rf helloworld/helloworld.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

## 3. è¤‡æ•°`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ©ç”¨

ã‚‚ã†ä¸€ã¤ã®`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
cat << EOF > helloworld/greeting.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld";

message Greeting { string greet_message = 1; }
EOF
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.proto
     | helloworld.proto
```

è¤‡æ•°`.proto`ãƒ•ã‚¡ã‚¤ãƒ«åˆ©ç”¨æ™‚ã¯ã€`protoc`ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°ã§ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ã†ã¨ä¾¿åˆ©ã§ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | greeting.proto
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
```

ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm helloworld/greeting.pb.go
rm helloworld/helloworld.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.proto
     | helloworld.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### 3.1 ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

æ¬¡ã«ã€ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
mkdir helloworld/subdir
cat << EOF > helloworld/subdir/subhello.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld/subdir";

// The greeting service definition.
service SubGreeter {
  // Sends a greeting
  rpc SayHello(SubHelloRequest) returns (SubHelloReply) {}
}

// The request message containing the user's name.
message SubHelloRequest { string name = 1; }

// The response message containing the greetings
message SubHelloReply { string message = 1; }
EOF
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

å¼•æ•°ã«`helloworld`ã¨`helloworld/subdir`ã®ä¸¡æ–¹ã‚’æŒ‡å®šã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
     | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | greeting.proto
     + subdir
       | subhello.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
       | subhello.proto
```

ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm helloworld/greeting.pb.go
rm helloworld/helloworld.pb.go
rm helloworld/subdir/subhello.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

## 4. import ã‚’åˆ©ç”¨ã™ã‚‹

`helloworld.proto`ã‹ã‚‰ã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«`greeting.proto`ã§å®šç¾©ã—ãŸ`message Greeting`ã‚’åˆ©ç”¨ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã©ã†ãªã‚‹ã§ã—ã‚‡ã†ï¼Ÿ

```diff:helloworld/helloworld.proto
message HelloReply {
  string message = 1;
+  Greeting greet = 2;
}
```

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
"Greeting" seems to be defined in "greeting.proto", which is not imported by "helloworld.proto".
To use it here, please add the necessary import.
```

### 4.1 `import`ã‚¨ãƒ©ãƒ¼ã®è§£æ±º

ã‚¨ãƒ©ãƒ¼ã®è§£æ±ºã«ã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ã‚‹ã‚ˆã†ã«ã€`helloworld.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã§ã€`greeting.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`import`ã—ã¾ã™ã€‚

> You can use definitions from other .proto files by importing them - [Protocol Buffers å…¬å¼: Language Guide (proto3)](https://developers.google.com/protocol-buffers/docs/proto3#importing_definitions)

```diff:helloworld/helloworld.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld";

+ã€€import "greeting.proto";
```

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

ã—ã‹ã—ã€ã¾ã ã‚¨ãƒ©ãƒ¼å‡ºã¾ã™ã€‚

```sh:ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
greeting.proto: File not found.
helloworld/helloworld.proto: Import "greeting.proto" was not found or had errors.
helloworld/helloworld.proto:19:3: "Greeting" seems to be defined in "helloworld/greeting.proto",
  which is not imported by "helloworld/helloworld.proto".
  To use it here, please add the necessary import.
```

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«`imported by "helloworld/helloworld.proto"`ã¨ã‚ã‚‹ã®ã§`import`ã®ãƒ‘ã‚¹ã‚’æ›¸ãæ›ãˆã¾ã—ã‚‡ã†ã€‚

```diff:helloworld/helloworld.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld";

-ã€€import "greeting.proto";
+ã€€import "helloworld/greeting.proto";
```

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

ã‚¨ãƒ©ãƒ¼ãŒè§£æ±ºã§ãã¾ã—ãŸã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | greeting.proto
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
     + subdir
       | subhello.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
       | subhello.proto
```

ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm helloworld/greeting.pb.go
rm helloworld/helloworld.pb.go
rm helloworld/subdir/subhello.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

### 4.2 `--proto_path` (çœç•¥å½¢ã¯`-I`)ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å‹•ä½œç¢ºèª

å…ˆç¨‹ã®ã‚¨ãƒ©ãƒ¼ã¯`--proto_path`ã‚’æŒ‡å®šã«ã‚ˆã£ã¦ã‚‚è§£æ±ºã§ãã¾ã™

> `IMPORT_PATH` specifies a directory in which to look for `.proto` files when resolving `import` directives. - [Protocol Bullfers å…¬å¼: Language Guide (proto3)](https://developers.google.com/protocol-buffers/docs/proto3)

ãã‚Œã§ã¯`helloworld.proto`ã®`import`ãƒ‘ã‚¹ã‚’æˆ»ã—ã¾ã—ã‚‡ã†ã€‚

```diff:helloworld/helloworld.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld";

-ã€€import "helloworld/greeting.proto";
+ã€€import "greeting.proto";
```

`--proto_path=helloworld`ã‚’æŒ‡å®šã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --proto_path=helloworld \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

`pb.go`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§ã‚ã‚‹`protoc-go-experiments`ã«é…ç½®ã•ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚å…ˆç¨‹ã¾ã§ã¨é…ç½®ãŒå¤‰ã‚ã£ã¦ã„ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
  | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
  + subdir
  | | subhello.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
  |
  + helloworld # ã“ã‚Œä»¥ä¸‹ã¯.protoãƒ•ã‚¡ã‚¤ãƒ«
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

ã“ã“ã¾ã§ã¯`helloworld`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚`.pb.go`ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚é…ç½®ã—ã¦ã„ãŸã®ã§ã€åŒã˜é…ç½®ã‚’å†ç¾ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm greeting.pb.go
rm helloworld.pb.go
rm -rf subdir
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.proto
     | helloworld.proto
     + subdir
       | subhello.proto
```

`--go_out=helloworld`ã§ Go ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --proto_path=helloworld \
  --go_out=helloworld --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | greeting.proto
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
     + subdir
       | subhello.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
       | subhello.proto
```

ãŸã—ã‹ã«ã“ã‚Œã¾ã§ã® Go ã‚³ãƒ¼ãƒ‰ç”Ÿæˆå…ˆã¨åŒã˜çŠ¶æ…‹ã‚’å†ç¾ã§ãã¾ã—ãŸãŒã€ã“ã®`--proto_path`ã¨`--go_out`ã®æŒ‡å®šæ–¹æ³•ã¯ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«æ²¿ã£ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿæ¬¡ã‹ã‚‰ã¯ã“ã®ç‚¹ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ã€‚

ç”Ÿæˆã—ãŸ Go ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ—¦æ¶ˆå»ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
rm helloworld/greeting.pb.go
rm helloworld/helloworld.pb.go
rm helloworld/subdir/subhello.pb.go
```

`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒæ®‹ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

ã“ã‚Œã§ã€æ¬¡ã®å®Ÿé¨“ã¸ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚

## 5. `--proto_path` `--go_out` `--go_opt` ã®æŒ‡é‡

Protocol Buffers å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ç½®ãå ´æ‰€ã‚„ã€ãã‚Œã«ä¼´ã†`--proto_path` `--go_out` `--go_opt` æŒ‡å®šã®æŒ‡é‡ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚

ã¾ãšã¯`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã®ç½®ãå ´æ‰€ã§ã™ã€‚

> Prefer not to put `.proto` files in the same directory as other language sources. Consider creating a subpackage `proto` for `.proto` files, under the root package for your project. - [Protocol Buffers å…¬å¼: Language Guide (proto3)](https://developers.google.com/protocol-buffers/docs/proto3)

æœ¬è¨˜äº‹ã§ã¯`proto`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä»£ã‚ã‚Šã«ã€`helloworld`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¾ã—ãŸã€‚

```sh
+ protoc-go-experiments
  + helloworld
     | helloworld.proto
     | greeting.proto
     + subdir
       | subhello.proto
```

ã‚ã‚‹ç¨‹åº¦ä»¥ä¸Šã®è¦æ¨¡ã®é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Œã°ã€ã‚ã‚‹`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€åˆ¥ã®`.proto`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`import`ã™ã‚‹ã“ã¨ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚

`import`ã«ã¯`--proto_path`ã®æŒ‡å®šãŒé‡è¦ã«ãªã‚Šã€ä»®ã«`--proto_path`ã‚’æŒ‡å®šã—ãªã‹ã£ãŸã¨ã—ã¦ã‚‚æš—é»™çš„ã«æŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

> If no flag was given, it looks in the directory in which the compiler was invoked. - [Protocol Buffers å…¬å¼: Language Guide (proto3)](https://developers.google.com/protocol-buffers/docs/proto3)

ã¤ã¾ã‚Šã€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã¨ã€

```
protoc \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¨åŒç­‰ã§ã™ã€‚

```
protoc \
  --proto_path=. \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

å…ˆç¨‹ã® 4. ã§ã¯`--proto_path=.`ã¨`--proto_path=helloworld`ä¸¡æ–¹ã®æŒ‡å®šã‚’è©¦ã—ã¾ã—ãŸãŒã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æŒ‡é‡ã¯ã“ã¡ã‚‰ã§ã™ã€‚

> In general you should set the `--proto_path` flag to the root of your project and use fully qualified names for all imports. - [Protocol Buffers å…¬å¼: Language Guide (proto3)](https://developers.google.com/protocol-buffers/docs/proto3)

ã¤ã¾ã‚Šã€`.proto`ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®`import`ã¯ã“ã®ã‚ˆã†ã« fully qualified ãªãƒ‘ã‚¹ã§æŒ‡å®šã—ã€

```diff:helloworld/helloworld.proto
syntax = "proto3";

option go_package = "github.com/richardimaoka/protoc-go-experiments/helloworld";

-ã€€import "greeting.proto";
+ã€€import "helloworld/greeting.proto";
```

`protoc`ã¯é€šå¸¸ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã™ã‚‹ã®ã§ã€`--proto_path`ã‚‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‚’æŒ‡å®šã—ã¾ã™ã€‚

```sh:ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ä¸‹ã•ã„
protoc \
  --proto_path=. \
  --go_out=. --go_opt=paths=source_relative \
  helloworld/*.proto helloworld/subdir/*.proto
```

```sh:ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
+ protoc-go-experiments
  + helloworld
     | greeting.pb.go   # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | greeting.proto
     | helloworld.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
     | helloworld.proto
     + subdir
       | subhello.pb.go # <- ã“ã‚ŒãŒç”Ÿæˆã•ã‚ŒãŸGoã‚³ãƒ¼ãƒ‰
       | subhello.proto
```

`--go_opt`ã«ã¤ã„ã¦ã¯ã€æœ¬è¨˜äº‹ã§ã¯`paths=source_relative`ã®ã¿è§£èª¬ã—ãŸã®ã§ã€ä»–ã®å€¤ã¯æ©Ÿä¼šãŒã‚ã‚Œã°åˆ¥è¨˜äº‹ã§ç´¹ä»‹ã—ã¾ã™ã€‚

ä»¥ä¸ŠãŒå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ²¿ã£ãŸ`--proto_path` `--go_out` `--go_opt` ã®æŒ‡å®šæ–¹æ³•ã§ã—ãŸã€‚
