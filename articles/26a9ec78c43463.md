---
title: "ã‚µãƒ¼ãƒãƒ¼å¾…ã¡ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’Apollo Client + Reactã§è¡Œã†"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢h" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GraphQL", "ã‚³ãƒ”ãƒšã§å­¦ã¶ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«"]
published: true
---

## å°å…¥

Apollo Client ã§æ§‹ç¯‰ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”å¾…ã¡ã®é–“ã«ã€ã„ã‚ã‚†ã‚‹ã€Œã‚¹ãƒ”ãƒŠãƒ¼ã€ãªã©ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’è¡Œã„ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

https://youtu.be/6ZIySVuxsCU

:::details React Suspense ã¯ä½¿ã‚ãªã„ã®ï¼Ÿ

Apollo Clientã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³3.8ã§Suspenseã«å¯¾å¿œã—ã¾ã—ãŸ https://www.apollographql.com/docs/react/data/suspense

~~ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’è¡Œã„ãŸã„å ´åˆã€React 18 ä»¥é™ã§ã¯[Suspense](https://reactjs.org/blog/2022/03/29/react-v18.html#suspense-in-data-frameworks)ãŒé¸æŠè‚¢ã«ä¸ŠãŒã‚‹ã§ã—ã‚‡ã†ã€‚ã¨ã“ã‚ãŒã€[GitHub: apollo-client - Adding React suspense + data fetching support](https://github.com/apollographql/apollo-client/issues/9627)ã«ã‚ã‚‹ã‚ˆã†ã«ã€Apollo Client å…¬å¼ã§ã¯ã¾ã  Suspense ã¨ã®çµ±åˆæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ã¾ã›ã‚“ã€‚~~

~~Apollo Client å…¬å¼ãŒæ¨å¥¨ã™ã‚‹æ–¹æ³•ãŒæ±ºã¾ã‚‹ã¾ã§ã¯ã€æœ¬è¨˜äº‹ã®ã‚ˆã†ã« Suspense ã‚’ä½¿ã‚ãªã„å¾“æ¥ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒå‚è€ƒã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚~~
:::

## äº‹å‰æº–å‚™

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ä½œæˆã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®æ§‹æˆã¯ã“ã¡ã‚‰ã§ã™ã€‚

![apollo-client-loading-architecture](/images/26a9ec78c43463/apollo-client-loading-architecture.png)

ã“ã¡ã‚‰ã®æ§‹æˆã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### äº‹å‰æº–å‚™ 1. ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

ã¾ãšã¯æœ¬ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
mkdir tutorial-apollo-client-loadinã€‚
cd tutorial-apollo-client-loading
```

å…¨ä½“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯æœ€çµ‚çš„ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
tutorial-apollo-client-loading
  +- server  # Apollo GraphQL Server
  +- client  # React Client
```

ãã‚Œã§ã¯æ¬¡ã®æ‰‹é †ã§ã€ä¸Šè¨˜ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã®ã†ã¡ã€`server`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ä½œæˆã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### äº‹å‰æº–å‚™ 2. GraphQL ã‚µãƒ¼ãƒãƒ¼

2 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã€Apollo Server ã¨ Server å´ã® GraphQL codegen ã‚’ç«‹ã¡ä¸Šã’ã¾ã™ã€‚

![server procs](/images/26a9ec78c43463/server-side.png)

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# ä¸€åº¦ã«å…¨éƒ¨ã‚³ãƒ”ãƒšã§å®Ÿè¡Œã§ãã¾ã™
mkdir server
cd server

# node.js setup
npm init -y
echo "node_modules" > .gitignore
```

TypeScript ã‚’å°å…¥ã—ã¦ã€ts-node-dev ã§ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã‚‹æº–å‚™ã‚’ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# install and initialize typescript
npm install --save-dev typescript
npx tsc --init

# ts-node-dev: watch and restart a TypeScript server
npm install --save-dev ts-node-dev
npm pkg set scripts.start="ts-node-dev --watch src/*,data/*,./schema.gql --respawn src/index.ts"
```

Apollo Server ã¨ GraphQL Codegen ã‚’å°å…¥ã—ã¾ã™ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# apollo server
npm install apollo-server graphql

# install and setup graphql-codegen
npm install --save-dev @graphql-codegen/cli

# ã“ã“ã§ npx graphql-code-generator init ã‚’è¡Œã‚ãšã€å¾Œã§codegen.tsã‚’ç”Ÿæˆã€‚ç†ç”±ã¯å¾Œè¿°ã€‚
npm install --save-dev \
  @graphql-codegen/typescript \
  @graphql-codegen/typescript-resolvers

npm pkg set scripts.generate="graphql-codegen --config codegen.yml --watch ./schema.gql,./data/*" # update generate script
```

`@graphql-codegen/cli`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã€é€šå¸¸ã¯ã‚³ãƒãƒ³ãƒ‰`npx graphql-code-generator init`ã«ã‚ˆã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«`codegen.ts`ã‚’ç”Ÿæˆã—ã¾ã™ãŒã€ãã†ã™ã‚‹ã¨å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã£ã¦ã—ã¾ã„æ‰‹å…¥åŠ›ãŒå¢—ãˆã‚‹ã®ã¨ã€çµå±€ã¯ç”Ÿæˆã•ã‚ŒãŸ config.ts ã‚’ä¸Šæ›¸ãå¤‰æ›´ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ config.ts ã‚’ä½œæˆã—ã¾ã™ã€‚

```ts:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cat << EOF > codegen.ts;
import type { CodegenConfig } from "@graphql-codegen/cli";

const config: CodegenConfig = {
  overwrite: true,
  schema: "schema.gql",
  generates: {
    "src/generated/graphql.ts": {
      plugins: ["typescript", "typescript-resolvers"],
      config: {
        avoidOptionals: true,
      },
    },
  },
  hooks: {
    afterOneFileWrite: ["npx prettier --write"],
  },
};

export default config;
EOF;
```

Apollo Server ç«‹ã¡ä¸Šã’ã«å¿…è¦ãªåˆæœŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# é–‹ç™ºãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
# ã“ã†ã—ãªã„ã¨ã€æ¬¡ã®git applyãŒã‚¨ãƒ©ãƒ¼ã®ç†ç”±ã‚‚çŸ¥ã‚‰ã›ãšå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
cd ../

curl https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/65243e4ea244df1fd0bac1aeda9030643278e16c.patch \
  | git apply -v -
```

ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹å¤‰æ›´å†…å®¹ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã®ã¨ãŠã‚Šã§ã™ã€‚

https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/65243e4ea244df1fd0bac1aeda9030643278e16c

ãã‚Œã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã® 2 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¾ã—ã‚‡ã†ã€‚

![server procs](/images/26a9ec78c43463/server-side.png)

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cd server
npm run codegen # Serer GraphQL codegen
```

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cd server
npm run start # Apollo Server
```

2 ã¤ã‚ã®ã‚³ãƒãƒ³ãƒ‰ã§ä»¥ä¸‹ã®ã‚ˆã†ã« GraphQL ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚

```:å®Ÿè¡Œçµæœ
ğŸš€  Server ready at: http://localhost:4000/
```

ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ http://localhost:4000/ ã‚’é–‹ã„ã¦ã€Query your server ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ä¸‹ã•ã„ã€‚

![apollo-server-ready](/images/26a9ec78c43463/apollo-server-ready.png)

ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¦ã€çµæœãŒè¿”ã£ã¦ãã‚Œã°æˆåŠŸã§ã™ã€‚

![apollo-server](/images/26a9ec78c43463/apollo-server.png)

å®Ÿè¡Œã™ã‚‹ GraphQL ã‚¯ã‚¨ãƒªã¯ã“ã¡ã‚‰ã§ã™ã€‚

```gql
{
  employees {
    jobTitle
    name
    picturePath
  }
}
```

### äº‹å‰æº–å‚™ 3. React ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

ã“ã“ã‹ã‚‰ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã® 2 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã«è¿½åŠ ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒ—ãƒ­ã‚»ã‚¹ã‚’ 2 ã¤ç«‹ã¡ä¸Šã’ã¾ã™ã€‚

![four-processes](/images/26a9ec78c43463/four-processes.png)

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
npx create-react-app client --template typescript

cd client
npx prettier --write .
```

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# apollo client
npm install @apollo/client graphql

# install and setup graphql-codegen
npm install --save-dev @graphql-codegen/cli

# ã“ã“ã§ npx graphql-code-generator init ã‚’è¡Œã‚ãšã€å¾Œã§codegen.tsã‚’ç”Ÿæˆã€‚ç†ç”±ã¯å¾Œè¿°ã€‚
npm install --save-dev \
  @graphql-codegen/typescript-operations \
  @graphql-codegen/typescript \
  @graphql-codegen/typescript-react-apollo

npm pkg set scripts.codegen="graphql-codegen --config codegen.ts --watch src/\\*_/_.tsx,../server/schema.gql"
```

`@graphql-codegen/cli`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå¾Œã€é€šå¸¸ã¯ã‚³ãƒãƒ³ãƒ‰`npx graphql-code-generator init`ã«ã‚ˆã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«`codegen.ts`ã‚’ç”Ÿæˆã—ã¾ã™ãŒã€ãã†ã™ã‚‹ã¨å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã£ã¦ã—ã¾ã„æ‰‹å…¥åŠ›ãŒå¢—ãˆã‚‹ã®ã¨ã€çµå±€ã¯ç”Ÿæˆã•ã‚ŒãŸ config.ts ã‚’ä¸Šæ›¸ãå¤‰æ›´ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ config.ts ã‚’ä½œæˆã—ã¾ã™ã€‚

```ts:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cat << EOF > codegen.ts
import type { CodegenConfig } from "@graphql-codegen/cli";

const config: CodegenConfig = {
  overwrite: true,
  schema: "../server/schema.gql",
  documents: "src/**/*.tsx",
  generates: {
    "src/generated/graphql.ts": {
      plugins: [
        "typescript",
        "typescript-operations",
        "typescript-react-apollo",
      ],
      config: {
        avoidOptionals: true,
      },
    },
  },
  hooks: {
    afterOneFileWrite: ["npx prettier --write"],
  },
};

export default config;
EOF
```

ç¶šã„ã¦ã€å¾Œã»ã©ã‚¹ãƒ”ãƒŠãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ã®ã«åˆ©ç”¨ã™ã‚‹ FontAwesome ã‚‚å°å…¥ã—ã¾ã—ã‚‡ã†ã€‚[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® React ç”¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †](https://fontawesome.com/docs/web/use-with/react/)ã«å¾“ã£ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# Add SVG Core
npm i --save @fortawesome/fontawesome-svg-core

# Add Icon Packages
npm i --save @fortawesome/free-solid-svg-icons
npm i --save @fortawesome/free-regular-svg-icons

# Add the React Component
npm i --save @fortawesome/react-fontawesome@latest
```

React + Apollo Client ç«‹ã¡ä¸Šã’ã«å¿…è¦ãªåˆæœŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# é–‹ç™ºãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
# ã“ã†ã—ãªã„ã¨ã€æ¬¡ã®git applyãŒã‚¨ãƒ©ãƒ¼ã®ç†ç”±ã‚‚çŸ¥ã‚‰ã›ãšå¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
cd ../

curl https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/aba557674d984551b8533d5b5b6cdd10109d9ae7.patch \
  | git apply -v -
```

ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹å¤‰æ›´å†…å®¹ã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã®ã¨ãŠã‚Šã§ã™ã€‚

https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/aba557674d984551b8533d5b5b6cdd10109d9ae7

ãã‚Œã§ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã® 2 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç«‹ã¡ä¸Šã’ã¾ã—ã‚‡ã†ã€‚

![four-processes](/images/26a9ec78c43463/four-processes.png)

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cd client
npm run codegen # Client GraphQL codegen
```

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
cd client
npm run start # React Apollo Client
```

ã“ã“ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ https://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

![faces](/images/26a9ec78c43463/faces.png)

## ã‚µãƒ¼ãƒãƒ¼å¾…ã¡ãŒã‚ã‚‹å ´åˆã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

ã„ã‚ˆã„ã‚ˆã‚µãƒ¼ãƒãƒ¼å¾…ã¡ã®ãŸã‚ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã®é…å»¶ã‚’å°å…¥ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’è¡Œã„ã¾ã™ã€‚

### ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«é…å»¶ã‚’æŒ¿å…¥

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# é–‹ç™ºãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã‹ã‚‰å®Ÿè¡Œ
curl https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/4f982c7d0c6f4367835a52d5137e3694903f1f99.patch \
  | git apply -v -
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯ã“ã¡ã‚‰ã®é€šã‚Šã§ã™](https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/4f982c7d0c6f4367835a52d5137e3694903f1f99)ã€‚

```diff:
+ import { setTimeout } from "timers/promises";

...

search: async (_parent, _args, context, _info) => {
+  console.log("waiting started");
+  await setTimeout(3000, null);
+  console.log("waiting ended");
  return context.Query.search;
},
```

:::details await setTimeout(3000,null) ã¯ãªã«ï¼Ÿ

https://nodejs.org/api/timers.html#timers_timers_promises_api ã‚’åˆ©ç”¨ã—ãŸ sleep å‡¦ç†ã§ã™ã€‚ã“ã® Node.js ã® Timers Promises API ã¯ Node.js ã® 16 ã‹ã‚‰å®‰å®šç‰ˆã«ãªã‚Šã¾ã—ãŸã€‚

ä»¥å‰ã¯ [Stack Overflow - How can I wait In Node.js (JavaScript)? l need to pause for a period of time](https://stackoverflow.com/a/49139664)ã§è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¤ãƒ‡ã‚£ã‚ªãƒ ã‚’æ›¸ã„ã¦ Sleep ã‚’è¡¨ç¾ã™ã‚‹ã“ã¨ãŒé€šä¾‹ã§ã—ãŸã€‚

```js
await new Promise((resolve) => setTimeout(resolve, 5000));
```

ã“ã‚Œã¯ã€Œä½•ã‚‚ã›ãš 5000 ãƒŸãƒªç§’å¾Œã« resolve ã—ã¦çµ‚ã‚ã‚‹ Promiseã€ã§ã‚ã‚Šã€ãã‚Œã‚’ await ã§å¾…ã£ã¦ã„ã‚‹å‡¦ç†ã§ã™ã€‚æ…£ã‚Œã¦ã—ã¾ãˆã°ã€ã‚ã‚‹ã„ã¯ Promise ã‚„ async/await ã«è©³ã—ã‘ã‚Œã°æ„å›³ã‚’èª­ã¿å–ã‚Œã‚‹ã‚‚ã®ã®ã€ã§ãã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ã«ã‹ã‘ãŸã»ã†ãŒã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ã€‚

```js
await setTimeout(5000, null);
```

Timers Promises API ãªã‚‰ã“ã‚ŒãŒå®Ÿç¾ã§ãã¾ã™ã€‚

:::

ãã‚Œã§ã¯ã‚µãƒ¼ãƒãƒ¼å´ã®é…å»¶ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ 3 ç§’ã»ã©å¾…ã£ã¦ã‹ã‚‰ã‚¯ã‚¨ãƒªçµæœãŒè¿”ã£ã¦ãã¦ã„ã¾ã™ã€‚

https://www.youtube.com/watch?v=WhZ8lURGXP4

Apollo Server ã®ãƒ­ã‚°ã«ã¯ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
ğŸš€  Server ready at: http://localhost:4000/
waiting started
waiting ended
```

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’å°å…¥

```sh:ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
# é–‹ç™ºãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã‹ã‚‰å®Ÿè¡Œ
curl https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/c599fc6b3b29e54196a659ebcfa0e6e38e004871.patch \
  | git apply -v -
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯ã“ã¡ã‚‰ã®é€šã‚Šã§ã™](https://github.com/richardimaoka/tutorial-apollo-client-loading/commit/c599fc6b3b29e54196a659ebcfa0e6e38e004871)ã€‚FontAwesome ã‚’åˆ©ç”¨ã—ãŸã‚¹ãƒ”ãƒŠãƒ¼ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

```diff:
+ import { faSpinner } from "@fortawesome/free-solid-svg-icons";
+ import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";

...

export const EmployeeListing = () => {
  const { loading, error, data } = useGetEmployeesQuery();
-  if (loading) return <>Loading...</>;
+  if (loading)
+    return (
+      <div>
+        <FontAwesomeIcon icon={faSpinner} size={"4x"} spin={true} />
+      </div>
+    );
  if (error) return <>error happened</>;
  if (!data || !data.employees) return <>empty data</>;

  ...
```

å®Œæˆå½¢ã¯ã“ã¡ã‚‰ã®ã¨ãŠã‚Šã§ã™ã€‚ç„¡äº‹ GraphQL ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å¾…ã¤é–“ã‚¹ãƒ”ãƒŠãƒ¼ã«ã‚ˆã‚‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’è¡Œã† React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½œå‹•ã—ã¾ã—ãŸã€‚

https://youtu.be/6ZIySVuxsCU
