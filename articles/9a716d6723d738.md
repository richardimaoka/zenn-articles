---
title: "Reactアプリ上でソースコードを色つき表示するなら使うべきはPrism.js? Highlight.js? Monaco? それとも？"
emoji: "🐷"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["React"]
published: false
---

## 導入

ソースコードを色つき表示することは、視覚的な美しさのみならず、ユーザーにとっての読みやすさのために、とても重要です。

本記事では React アプリケーション上でソースコードを色つき表示するために使えるライブラリ、ツールなどの選択肢の中からひとつを選ぶため

- どうやって選択肢を絞り込むかの**判断基準**
- 色つき表示を行う、**主なライブラリやツール**

を紹介します。

## ソースコードをハイライトする仕組み

React アプリケーション上でソースコードを表示する場合、多くの人が一番最初に`<pre><code>`タグを思い浮かべると思います。しかし、`<pre><code>`タグはレイアウトしてくれるものの、色はつけてくれないので、そのままでは読みづらい表示になってしまいます。

```:色なし、<pre><code>だけで表示したGo言語のhello world
package main

import "fmt"

func main() {
    fmt.Println("hello world")
}
```

```go:色つきとの比較
package main

import "fmt"

func main() {
    fmt.Println("hello world")
}
```

React に限りませんが、HTML と CSS を使ってソースコードを色つき表示するには、ソースコード内の単語一つ一つを`<span>`で囲んで、`class`など (React の JSX では`className`) によって CSS を適用します。

```html:HTMLとCSSでハイライトするためには<span>で囲む
<pre>
  <code className="language-go code-line" data-line="26">
    <span className="token keyword">package</span> main
    <span className="token keyword">import</span> <span className="token string">"fmt"</span>
    <span className="token keyword">func</span> <span className="token function">main</span><span className="token punctuation">(</span><span className="token punctuation">)</span> <span className="token punctuation">{</span>
        fmt<span className="token punctuation">.</span><span className="token function">Println</span><span className="token punctuation">(</span><span className="token string">"hello world"</span><span className="token punctuation">)</span>
    <span className="token punctuation">}</span>
  </code>
</pre>
```

## ライブラリやツールが多くて迷ってしまうので、判断基準が必要

当然ながら一つ一つの`<span>`を手作業で書くわけにはいかないので、何らかのライブラリやツールに頼ることになりますが、ここで選べる選択肢が多すぎることが React 開発者にとっての悩みになってしまいます。

- 伝統的な Prism.js や Highlight.js
- React Syntax Highlighter などのコンポーネント
- CodePen のような埋込サービス
- Monaco Editor などのブラウザ内エディタ

そこで本記事では、React 開発者の悩みを減らせるよう、これらの選択肢から一つを選び出すための判断基準を紹介します。

まず重要な判断基準が、ソースコードが Read-Only か？ Editable か？です。

![](https://storage.googleapis.com/zenn-user-upload/d80fc29e4dad-20240926.jpg)

Read-Only で十分であれば、React Syntax Highlighter のようなシンプルかつ効果的な選択肢が利用可能です。しかし、Read-Only ではなく Editable なソースコードを実現するツール群は、一般に使い方が複雑であったり、JavaScript のファイルサイズが大きくなりがちです。このため、自身が開発する React アプリケーションにおいて「本当に Editable である必要があるのか？」を慎重に検討することが求められます。実際、ユーザーが手動でソースコードを記述する必要性は、開発者が想定するほど多くはなく、ユーザーはブラウザ上でのソースコード記述を望まないものです。

次に考慮すべき重要な判断基準は、「現代の React に対応しやすいか？」という点です。現在の React アプリケーションでは、Server Side Rendering や将来的に普及が期待される Server Component など、サーバー側での処理が一般的です。そのため、Browser API に依存してクライアントサイドでのみレンダリングを行う選択肢は、開発者にとって扱いづらいと感じられることがあります。ただし、これらの選択肢が React に不向きだと一概に決めつける必要はありません。慎重に注意点を考慮した上で、利用判断を行うことが求められます。

## Read-Only 系の選択肢

テキストエディタを実装するのはとても大変であることが知られている。だから Read-Only だと決めてしまえば、導入が楽なツールを使える。

それでは各選択肢を紹介していきましょう。

### React Syntax Highlighter

- Read-Only な選択肢
- 現代的な React にも対応 ◎
- 色つき表示以上の機能を求めると、足りないことも

React でソースコードを色つき表示 (Syntax Highlight) するライブラリとしては最も有名で、かつ本記事で紹介する選択肢の中でも最も導入が簡単なもののひとつです。

以下の npm コマンドを実行して

```
npm install react-syntax-highlighter --save
```

このようなコンポーネントを書けば、すぐに表示できてしまいます。

```js
import SyntaxHighlighter from "react-syntax-highlighter";
import { docco } from "react-syntax-highlighter/dist/esm/styles/hljs";

const Component = () => {
  const codeString = "(num) => num + 1";
  return (
    <SyntaxHighlighter language="javascript" style={docco}>
      {codeString}
    </SyntaxHighlighter>
  );
};
```

Browser API 二依存していないので現代的な React にも対応ずみです。Server Side Rendering でも問題なく動作しますし、Next.js 14 以降では普通のコンポーネントを書くだけで自動的に Server Component として使うことができます。それによって React Syntax Highlighter の JavaScript bundle サイズを気にする必要がなくなります。

:::details つまりこういうことを気にしなくて良くなります
https://github.com/react-syntax-highlighter/react-syntax-highlighter?tab=readme-ov-file#light-build
:::

Read-Only で利用すれば、Server Side Rendering や Server Component などサーバー側の処理だけで済むため、考慮すべきことが少なくなります。これにより hooks や状態管理など難しいことを考える必要もありません。

しかし、想定の機能を超える使い方をしようとすると苦労する場合があります。例えば「ソースコード内の特定行をハイライトしたい」というのはよくある要求ですが、React Syntax Highlighter は対応していません。自分で JavaScript を書いて機能を実現する必要があり、こちらの記事にあるような工夫が求められます。

TODO: 記事

さらに高度な機能をもとめると、React Syntax Highlighter では不適合になることもあるでしょう。特に、React Syntax Highlighter はソースコード表示部分に重ねるようにボタンやツールチップを配置するのが難しいため、こういった「自由自在に追加コンポーネントを配置する」場合には大体の選択肢が必要になってきます。

TODO: 画像

### 埋め込み系サービス

GitHub embed と Gist

CodePen なら書き込みも、あとから紹介

### Prism.js, Highlight.js

dangerouslyHTML は練習以外では避ける

### 自力で<pre><code>内に<span>を追加する

## Editable 系の選択肢

### 埋め込み系サービス

### Monaco Editor

### Ace Editor, CodeMirror
