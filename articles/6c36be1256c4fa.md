---
title: "ã‚³ãƒ”ãƒšã§å­¦ã¶ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: GitHub Pull Request ã® updateæ‰‹æ³•2ç¨®é¡ã‚’è©¦ã™"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢h" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["git"]
published: false
---

## å°å…¥

GitHub ã® pull request ã§ã¯ã€base ãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ã‚’å–ã‚Šè¾¼ã‚“ã§ pull request ã®åŒæœŸã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€ Update with merge commit ã¨ Update with rebase ã¨ã„ã† 2 ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

![update with merge commit](/images/6c36be1256c4fa/update-with-merge-commit.png)

- [GitHub å…¬å¼: ãƒ™ãƒ¼ã‚¹ ãƒ–ãƒ©ãƒ³ãƒã¨ pull request ã®åŒæœŸã®ç¶­æŒ](https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/keeping-your-pull-request-in-sync-with-the-base-branch)
- [GitHub blog: More ways to keep your pull request branch up-to-date](https://github.blog/changelog/2022-02-03-more-ways-to-keep-your-pull-request-branch-up-to-date/)

ã“ã‚Œã‚‰ 2 ã¤ã®æ–¹æ³•ã¯ã€ä¸Šç”»åƒã®ã‚ˆã†ã«ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã²ã¨ã¤ã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ãŒã€ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã„ã„ã‹æ‚©ã‚€æ–¹ã‚‚ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚è‡ªä¿¡ã‚’ã‚‚ã£ã¦é¸ã¶ãŸã‚ã«ã¯ã€æ‰‹ã‚’å‹•ã‹ã—ã¦ 2 ã¤æ‰‹æ³•ã®é•ã„ã‚’å®Ÿéš›ã«ç¢ºèªã™ã‚‹ã“ã¨ã¯å½¹ç«‹ã¤ã§ã—ã‚‡ã†ã€‚æœ¬è¨˜äº‹ã§ã¯ã»ã¼ã‚³ãƒ”ãƒšã§è²¼ã‚Šä»˜ã‘ã‚‹ã ã‘ã§ç°¡å˜ã«æ‰‹é †ã‚’å†ç¾ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

:::details merge conflict ãŒã‚ã‚‹å ´åˆã€æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ 2 ã¤ã®æ‰‹æ³•ã¯ä½¿ãˆã¾ã›ã‚“

æœ¬è¨˜äº‹ã§å¯¾è±¡ã¨ã™ã‚‹ã®ã¯ pull request ã« merge conflict ãŒãªã„å ´åˆã®ã¿é©ç”¨ã§ãã‚‹æ‰‹æ³•ã§ã™ã€‚merge conflict ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã¨ãã«è§£æ±ºã™ã‚‹æ‰‹æ³•ã¨ã¯åŒºåˆ¥ã—ã¦ãã ã•ã„ã€‚å¾Œè€…ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

- [GitHub å…¬å¼: GitHub ã§ã®ãƒãƒ¼ã‚¸ ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±ºã™ã‚‹](https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-on-github)
- [GitHub å…¬å¼: ã‚³ãƒãƒ³ãƒ‰ ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ¼ã‚¸ ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±ºã™ã‚‹](https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/addressing-merge-conflicts/resolving-a-merge-conflict-using-the-command-line)
- [ã‚³ãƒ”ãƒšã§å­¦ã¶ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: GitHub Pull Request ã® merge conflict è§£æ±ºæ‰‹æ³•ã‚’è©¦ã™](./34aefc43a988ca)

:::

:::details pull request ã® merge æ‰‹æ³•ã¨ã®åŒºåˆ¥

æœ¬è¨˜äº‹ã§å¯¾è±¡ã¨ã™ã‚‹ã®ã¯ pull requestã€å†…ã€ã§ merge conflict ã‚’è§£æ±ºã™ã‚‹æ‰‹æ³•ãªã®ã§ã€pull request è‡ªä½“ã‚’ base ãƒ–ãƒ©ãƒ³ãƒã¸ã¨ merge ã™ã‚‹æ‰‹æ³•ã¨ã¯åŒºåˆ¥ã—ã¦ãã ã•ã„ã€‚å¾Œè€…ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

- [GitHub å…¬å¼: ã‚³ãƒãƒ³ãƒ‰ ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ãƒãƒ¼ã‚¸ ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’è§£æ±ºã™ã‚‹](https://docs.github.com/ja/pull-requests/collaborating-with-pull-requests/incorporating-changes-from-a-pull-request/about-pull-request-merges)
- [ã‚³ãƒ”ãƒšã§å­¦ã¶ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«: GitHub Pull Request 3 ç¨®é¡ã® merge æ‰‹æ³•ã‚’è©¦ã™](./f20aee8979292d)

:::

## æº–å‚™

### GitHub ãƒ¬ãƒã‚¸ãƒˆãƒªã®ä½œæˆ

ã¾ãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ git ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
mkdir pull-req-update-experiments
cd pull-req-update-experiments
git init
```

GitHub ä¸Šã«ãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ãªãã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ãˆã°ä¸€ç™ºã§çµ‚ã‚ã‚Šã¾ã™ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
gh repo create pull-req-update-experiments --public --source=. --remote=origin
```

:::details ã€€ä¸Šè¨˜ã® gh ã‚³ãƒãƒ³ãƒ‰ã¯ä½•ï¼Ÿ
[gh ã‚³ãƒãƒ³ãƒ‰(GitHub CLI)](https://cli.github.com/)ã‚’ä½¿ãˆã°ã€GitHub ä¸Šã§ã®ãƒªãƒã‚¸ãƒˆãƒªä½œæˆãªã©ä½œæ¥­ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã²ã¨ã¤ã§è¡Œãˆã¾ã™ã€‚ã¾ã ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„æ–¹ã¯ã€ãœã²ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚[gh repo create ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜](https://cli.github.com/manual/gh_repo_create)ã«ã‚‚ã‚ã‚Šã¾ã™ãŒã€ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨å¼•æ•°ã®æ„å‘³ã¯ã“ã¡ã‚‰ã§ã™ã€‚

- `pull-req-merge-experiments`: GitHub ä¸Šã®ãƒ¬ãƒã‚¸ãƒˆãƒªå
- `--public`: public ãƒ¬ãƒã‚¸ãƒˆãƒªã¨ã—ã¦ä½œæˆ
- `--source=.`: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¬ãƒã‚¸ãƒˆãƒªã®ãƒ‘ã‚¹ã¯ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `.`
- `--remote=origin` ãƒªãƒ¢ãƒ¼ãƒˆãƒ¬ãƒã‚¸ãƒˆãƒªã‚’ origin ã«æŒ‡å®š

:::

### Update branch ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã® GitHub è¨­å®š

Update branch ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã¯ GitHub ã§ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã® 2 ç¨®é¡ã®ã†ã¡ã€æœ¬è¨˜äº‹ã§ã¯å¾Œè€…ã®è¨­å®šã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

:::details 1. Require branches to be up to date before merging (update branch å¿…é ˆ)

ãƒãƒ¼ã‚¸å‰ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯å¿…é ˆ

https://docs.github.com/ja/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches#require-status-checks-before-merging

![require-branches-to-be-up-to-date](/images/6c36be1256c4fa/require-branches-to-be-up-to-date.png)

![out of date](/images/6c36be1256c4fa/out-of-date.png)

:::

:::details 2. Always suggest updating pull request branches (update branch å¿…é ˆã§ã¯ãªã„) - æœ¬è¨˜äº‹ã§æ¡ç”¨

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ ãƒ–ãƒ©ãƒ³ãƒã‚’æ›´æ–°ã™ã‚‹ææ¡ˆã®ç®¡ç†

https://docs.github.com/ja/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges/managing-suggestions-to-update-pull-request-branches

![always-suggest-updating-pr](/images/6c36be1256c4fa/always-suggest-updating-pr.png)

![update with merge commit](/images/6c36be1256c4fa/update-with-merge-commit.png)

[GitHub blog - More ways to keep your pull request branch up-to-date](https://github.blog/changelog/2022-02-03-more-ways-to-keep-your-pull-request-branch-up-to-date/)ã§ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

> A new repository setting lets admins opt into having the **Update branch** button always available whenever a pull request's branch is not up to date with the base branch. Previously, this button was only available when the **Require branches to be up to date before merging branch** protection setting was enabled.

:::

## æ‰‹æ³• 1 - Update with merge commit

ä¸Šè¨˜ã® GitHub è¨­å®šã‚’çµ‚ãˆãŸã‚‰ã€ã“ã“ã‹ã‚‰å…ˆã®æ‰‹é †ã«å¾“ã£ã¦ã€update branch ã®å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚ã¾ãšã¯ã€å¤‰æ›´å¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« `pull-req-update-with-merge.txt` ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
cat << EOF > experiment1.txt
a

b

c
EOF
git add --all
git commit -m "create experiment1.txt"
git push origin main
```

ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ã“ã¡ã‚‰ã§ã™ã€‚

```txt:experiment1.txt
a

b

c
```

æ¬¡ã«ã€pull request ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
git switch -c pr-1

sed -i 's/a/aaaaa/' experiment1.txt # ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã®aã‚’aaaaaã«ç½®ãæ›ãˆ
git add --all
git commit -m "update a in pr-1"

git push --set-upstream origin pr-1
gh pr create --title pr-1 --body "" --base main --head pr-1
```

pull request ä½œæˆæ™‚ç‚¹ã§ã¯ã€base ãƒ–ãƒ©ãƒ³ãƒã¯æœ€æ–°ãªã®ã§ã€update branch ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

![base branch up to date](/images/6c36be1256c4fa/base-branch-up-to-date.png)

base ãƒ–ãƒ©ãƒ³ãƒã«ç›´æ¥å¤‰æ›´ã‚’åŠ ãˆã€push ã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
git switch developer
sed -i 's/b/bbbbb/' pull-req-update-with-merge.txt # ãƒ•ã‚¡ã‚¤ãƒ«ä¸­ã®bã‚’bbbbbã«ç½®ãæ›ãˆ
git add --all
git commit -m "update b in developer"

git push origin developer
```

:::details base ãƒ–ãƒ©ãƒ³ãƒã® push ãŒ pull request ã® file diff ã«åæ˜ ã•ã‚Œãªã„ï¼Ÿ

:::

ã“ã‚Œã§ update branch ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€Update with merge commit ã‚’é¸æŠã—ã¾ã™ã€‚

![update with merge commit](/images/6c36be1256c4fa/update-with-merge-commit.png)

Update with merge commit ãŒå®Œäº†ã™ã‚‹ã¨ã€`Merge branch 'main' into ...` ã¨ pull request ã® Commits ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

![git log update with merge commit](/images/6c36be1256c4fa/git-log-update-with-merge.png)

åˆ†å²ã®æ§˜å­ã‚’è¦‹ã‚‹ãŸã‚ã€git log ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
git switch pr-1
git pull origin pr-1
git log --oneline --decorate --graph
```

```log:git log
* 6261845 (HEAD -> developer) Merge branch 'developer' into pr-update-with-merge
|\
| * 973896c update b in developer
* | 9378326 (origin/pr-update-with-merge) update a in pr-update-with-merge
|/
* 58cfed0 create pull-req-update-with-merge.txt
```

Update with merge commit ãŒå®Œäº†ã™ã‚‹ã¨ã€update branch ãƒœã‚¿ãƒ³ã¯æ¶ˆãˆã¾ã™ã€‚Merge pull request ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚

![base branch up to date](/images/6c36be1256c4fa/base-branch-up-to-date.png)

:::details ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ pull request ã‚’ãƒãƒ¼ã‚¸ã—ãŸã„å ´åˆ

ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
gh pr merge pr-1 --merge --delete-branch
```

:::

Merge pull request å¾Œã« main ãƒ–ãƒ©ãƒ³ãƒã® git log ã‚’ã¿ã‚‹ã¨ã“ã†ãªã£ã¦ã„ã¾ã™ã€‚

![git log pr merged 1](/images/6c36be1256c4fa/git-log-pr-merged-1.png)

åˆ†å²ã®æ§˜å­ã‚’è¦‹ã‚‹ãŸã‚ã€git log ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```sh:ã‚³ãƒ”ãƒšã—ã¦å®Ÿè¡Œ
git switch main
git pull origin main
git log --oneline --decorate --graph
```

```log:git log
*   c02aa4b (HEAD -> developer, origin/developer) Merge pull request #12 from richardimaoka/pr-update-with-merge
|\
| *   6261845 Merge branch 'developer' into pr-update-with-merge
| |\
| |/
|/|
* | 973896c update b in developer
| * 9378326 (origin/pr-update-with-merge) update a in pr-update-with-merge
|/
* 58cfed0 create pull-req-update-with-merge.txt
```

## æ‰‹æ³• 2 - Update with rebase

![update with rebase](/images/6c36be1256c4fa/update-with-rebase.png)
